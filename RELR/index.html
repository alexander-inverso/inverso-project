<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cromatografía: Extracción de Carotenoides | Reporteros en la Red 2026</title>
    <style>
        :root {
            --bg-color: #000000;
            --ui-bg: rgba(20, 20, 20, 0.85);
            --text-color: #e0e0e0;
            --accent-color: #00ff41; /* Verde matriz/técnico */
            --font-stack: 'Segoe UI', 'Roboto', 'Courier New', monospace;
            --anim-speed: 0.6s;
            --curve-depth: -800px; /* Profundidad del efecto 3D */
        }

        body {
            margin: 0;
            padding: 0;
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--font-stack);
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        /* --- ESCENARIO 3D --- */
        .carousel-viewport {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            perspective: 2000px;
            overflow: hidden;
            z-index: 1;
        }

        .carousel-item {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            /* Estado base oculto (atrás) */
            transform: translateZ(var(--curve-depth)); 
            transition: opacity var(--anim-speed), transform var(--anim-speed), filter var(--anim-speed);
            will-change: transform, opacity;
        }

        /* --- ESTADOS DE ANIMACIÓN --- */
        
        .carousel-item.active {
            opacity: 1;
            pointer-events: all;
            transform: translateZ(0) translateX(0) rotateY(0deg);
            filter: blur(0px);
            z-index: 10;
        }

        /* Salida Izquierda */
        .carousel-item.exit-left {
            opacity: 0;
            transform: translateX(-60%) translateZ(var(--curve-depth)) rotateY(45deg);
            filter: blur(10px);
        }

        /* Salida Derecha */
        .carousel-item.exit-right {
            opacity: 0;
            transform: translateX(60%) translateZ(var(--curve-depth)) rotateY(-45deg);
            filter: blur(10px);
        }

        /* Entrada (Pre-estado) */
        .carousel-item.enter-right { transform: translateX(60%) translateZ(var(--curve-depth)) rotateY(-45deg); }
        .carousel-item.enter-left { transform: translateX(-60%) translateZ(var(--curve-depth)) rotateY(45deg); }


        /* --- CAPA DE TRANSFORMACIÓN (Zoom/Pan) --- */
        .transform-layer {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            transform-origin: 0 0; 
            cursor: grab;
            /* Esta transición se desactiva dinámicamente al arrastrar */
            transition: transform 0.15s cubic-bezier(0.1, 0.7, 1.0, 0.1); 
        }

        .transform-layer:active {
            cursor: grabbing;
        }

        .carousel-item img {
            max-width: 100%;
            max-height: 100%;
            width: auto;
            height: auto;
            object-fit: contain;
            /* Sombra para dar volumen sobre el negro */
            box-shadow: 0 0 50px rgba(0,0,0,0.5); 
            /* Evitar que la imagen capture eventos de ratón nativos */
            pointer-events: none; 
        }


        /* --- INTERFAZ (HUD) --- */
        header {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            padding: 25px 40px;
            box-sizing: border-box;
            background: linear-gradient(to bottom, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0) 100%);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            z-index: 100;
            pointer-events: none;
        }

        .project-info { pointer-events: auto; }
        .project-info h1 {
            font-size: 1.3rem;
            margin: 0;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #fff;
            text-shadow: 0 0 15px rgba(0, 255, 65, 0.3);
        }
        .project-info h2 {
            font-size: 0.9rem;
            margin: 5px 0 0 0;
            color: var(--accent-color);
            font-weight: normal;
        }

        .meta-data {
            text-align: right;
            font-size: 0.8rem;
            color: #999;
            pointer-events: auto;
            line-height: 1.4;
        }

        /* ETIQUETAS */
        .image-label {
            position: absolute;
            bottom: 130px; /* Encima de la barra */
            left: 40px;
            background: rgba(15, 15, 15, 0.9);
            border-left: 3px solid var(--accent-color);
            padding: 15px 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-width: 450px;
            z-index: 90;
            backdrop-filter: blur(5px);
            border-radius: 0 10px 10px 0;
            
            /* Animación de entrada */
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s ease 0.4s;
        }

        .carousel-item.active .image-label {
            opacity: 1;
            transform: translateX(0);
        }

        /* --- BARRA DE CONTROL --- */
        .controls-bar {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--ui-bg);
            padding: 12px 30px;
            /* REDONDEZ RECUPERADA */
            border-radius: 50px; 
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255,255,255,0.15);
            display: flex;
            align-items: center;
            gap: 25px;
            z-index: 100;
            box-shadow: 0 15px 40px rgba(0,0,0,0.7);
        }

        .btn {
            background: transparent;
            border: none;
            color: #fff;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 8px 12px;
            letter-spacing: 1px;
            transition: color 0.2s, text-shadow 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            color: var(--accent-color);
            text-shadow: 0 0 8px rgba(0, 255, 65, 0.5);
        }

        .status-text {
            font-family: 'Courier New', monospace;
            font-size: 1rem;
            color: var(--accent-color);
            padding: 0 15px;
            font-weight: bold;
            border-left: 1px solid #444;
            border-right: 1px solid #444;
        }

        @media (max-width: 768px) {
            header { padding: 20px; flex-direction: column; }
            .meta-data { display: none; }
            .controls-bar { width: 85%; justify-content: space-between; bottom: 30px; padding: 10px 20px; }
            .image-label { left: 10px; right: 10px; bottom: 100px; max-width: none; border-radius: 5px; }
            .btn span { display: none; } /* Ocultar texto en móvil muy pequeño si es necesario */
        }
    </style>
</head>
<body>

    <header>
        <div class="project-info">
            <h1>Extracción de Carotenoides</h1>
            <h2>Reporteros en la Red 2026</h2>
        </div>
        <div class="meta-data">
            <div>Autor: Alexander de Toro Todorov</div>
            <div>Tutora: M.ª del Mar Inda Pérez</div>
            <div>Radio Exterior Alicante</div>
        </div>
    </header>

    <div class="carousel-viewport">
        
        <div class="carousel-item active">
            <div class="transform-layer">
                <img src="https://github.com/alexander-inverso/inverso-project/blob/main/RELR/Imagen.png?raw=true" alt="Escaneo">
            </div>
            <div class="image-label">
                <strong style="color:var(--accent-color)">REF: ESCANEO_HD</strong><br><br>
                Digitalización de alta resolución de las bandas de papel de filtro tras la cromatografía. Se aprecia una oxidación de los carotenoides por el aire (colores difuminados).
            </div>
        </div>

        <div class="carousel-item">
            <div class="transform-layer">
                <img src="https://github.com/alexander-inverso/inverso-project/blob/main/RELR/20260203_125116.jpg?raw=true" alt="Arrastre">
            </div>
            <div class="image-label">
                <strong style="color:var(--accent-color)">REF: TÉCNICA_ARRASTRE</strong><br><br>
                Imagen del proceso de cromatografía por arrastre. Se usaron capilares para depositar los pigmentos y una disolución 9:1 de ciclohexano:acetona para el arrastre.
            </div>
        </div>

        <div class="carousel-item">
            <div class="transform-layer">
                <img src="https://github.com/alexander-inverso/inverso-project/blob/main/RELR/20260128_162756.jpg?raw=true" alt="Capilaridad">
            </div>
            <div class="image-label">
                <strong style="color:var(--accent-color)">REF: CAPILARIDAD_BANDEJA</strong><br><br>
                Esta cromatografía se hizo mediante capilaridad sencilla. Las bandas de papel se colocaron directamente en contacto con las disuluciones de carotenoides.
            </div>
        </div>

    </div>

    <div class="controls-bar">
        <button class="btn" onclick="navigate(-1)">&#8592; ANT</button>
        <div class="status-text" id="status-counter">01 / 03</div>
        <button class="btn" onclick="navigate(1)">POST &#8594;</button>
        <button class="btn" onclick="resetView()" style="opacity:0.6; font-size:0.75rem; margin-left:10px;">[ RESTABLECER ]</button>
    </div>

    <script>
        // --- CONFIGURACIÓN ---
        const items = document.querySelectorAll('.carousel-item');
        const counter = document.getElementById('status-counter');
        let currentIndex = 0;
        let isAnimating = false;

        // Estado del Zoom/Pan por cada diapositiva
        let viewStates = Array.from({length: items.length}, () => ({
            scale: 1,
            pointX: 0,
            pointY: 0
        }));

        // Variables Globales para Arrastre (Drag Engine)
        let globalIsDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let initialDragX = 0;
        let initialDragY = 0;

        const MIN_ZOOM = 0.5;
        const MAX_ZOOM = 10;

        // --- INICIALIZACIÓN ---
        updateCounter();
        initEvents();

        // --- NAVEGACIÓN 3D ---
        function navigate(dir) {
            if (isAnimating) return; 
            isAnimating = true;

            const currentItem = items[currentIndex];
            let nextIndex = currentIndex + dir;

            if (nextIndex < 0) nextIndex = items.length - 1;
            if (nextIndex >= items.length) nextIndex = 0;

            const nextItem = items[nextIndex];

            // Dirección
            let exitClass = dir > 0 ? 'exit-left' : 'exit-right';
            
            // Setup Inicial del siguiente slide (sin transición para colocación instantánea)
            nextItem.className = 'carousel-item'; // Reset clases
            nextItem.style.transition = 'none'; // Importante: quitar transición para moverlo al start point
            
            if (dir > 0) {
                nextItem.style.transform = 'translateX(60%) translateZ(-800px) rotateY(-45deg)';
            } else {
                nextItem.style.transform = 'translateX(-60%) translateZ(-800px) rotateY(45deg)';
            }
            nextItem.style.opacity = '0';

            // Forzar reflow
            void nextItem.offsetWidth;

            // ACTIVAR ANIMACIÓN
            nextItem.style.transition = ''; // Recuperar transiciones CSS
            
            // Salida
            currentItem.classList.remove('active');
            currentItem.classList.add(exitClass);

            // Entrada
            nextItem.style.transform = ''; 
            nextItem.style.opacity = '';
            nextItem.classList.add('active');

            // Limpieza
            setTimeout(() => {
                currentItem.className = 'carousel-item';
                isAnimating = false;
            }, 600);

            currentIndex = nextIndex;
            updateCounter();
            resetView(false);
        }

        function updateCounter() {
            counter.innerText = `0${currentIndex + 1} / 0${items.length}`;
        }

        // --- MOTOR DE INTERACCIÓN (CORE) ---
        function initEvents() {
            
            // 1. EVENTOS GLOBALES DE ARRASTRE (Para evitar que se "pegue")
            window.addEventListener('mouseup', endDrag);
            window.addEventListener('mouseleave', endDrag);
            
            window.addEventListener('mousemove', (e) => {
                if (!globalIsDragging) return;
                e.preventDefault();

                const dx = e.clientX - dragStartX;
                const dy = e.clientY - dragStartY;

                const state = viewStates[currentIndex];
                state.pointX = initialDragX + dx;
                state.pointY = initialDragY + dy;

                renderTransform(currentIndex, false); // false = sin transición suave (raw movement)
            });

            // 2. EVENTOS POR ITEM
            items.forEach((slide, index) => {
                const layer = slide.querySelector('.transform-layer');

                // Mousedown: Iniciar Arrastre
                layer.addEventListener('mousedown', (e) => {
                    e.preventDefault(); // Evitar selección texto o drag nativo imagen
                    globalIsDragging = true;
                    
                    dragStartX = e.clientX;
                    dragStartY = e.clientY;
                    
                    const state = viewStates[index];
                    initialDragX = state.pointX;
                    initialDragY = state.pointY;

                    layer.style.cursor = 'grabbing';
                    layer.style.transition = 'none'; // CRÍTICO: Desactivar suavizado mientras arrastras
                });

                // Wheel: Zoom
                slide.addEventListener('wheel', (e) => {
                    e.preventDefault();
                    const state = viewStates[index];
                    const rect = slide.getBoundingClientRect();
                    
                    const mouseX = e.clientX - rect.left;
                    const mouseY = e.clientY - rect.top;

                    const delta = -e.deltaY;
                    const factor = 1 + (delta * 0.001);
                    const newScale = Math.min(Math.max(state.scale * factor, MIN_ZOOM), MAX_ZOOM);

                    if (newScale !== state.scale) {
                        const scaleRatio = newScale / state.scale;
                        state.pointX = mouseX - (mouseX - state.pointX) * scaleRatio;
                        state.pointY = mouseY - (mouseY - state.pointY) * scaleRatio;
                        state.scale = newScale;
                    }

                    renderTransform(index, true); // true = con transición suave
                }, { passive: false });
            });
        }

        function endDrag() {
            if (globalIsDragging) {
                globalIsDragging = false;
                const layer = items[currentIndex].querySelector('.transform-layer');
                if(layer) {
                    layer.style.cursor = 'grab';
                    // Reactivar transición suave para el siguiente zoom o movimiento
                    layer.style.transition = 'transform 0.15s cubic-bezier(0.1, 0.7, 1.0, 0.1)';
                }
            }
        }

        function renderTransform(index, smooth = true) {
            const state = viewStates[index];
            const layer = items[index].querySelector('.transform-layer');
            if(layer) {
                if(!smooth) {
                    layer.style.transition = 'none';
                }
                layer.style.transform = `translate(${state.pointX}px, ${state.pointY}px) scale(${state.scale})`;
            }
        }

        function resetView(forceRender = true) {
            viewStates[currentIndex] = { scale: 1, pointX: 0, pointY: 0 };
            if (forceRender) {
                const layer = items[currentIndex].querySelector('.transform-layer');
                layer.style.transition = 'transform 0.3s ease'; // Reset suave
                renderTransform(currentIndex);
            }
        }

        // Teclado
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') navigate(1);
            if (e.key === 'ArrowLeft') navigate(-1);
            if (e.key === 'Escape') resetView();
        });
    </script>
</body>
</html>
