<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEFQ: Jealousy Engine v31.0</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;800&display=swap');

        :root {
            --accent-color: #facc15;
            --danger-color: #f97316;
            --critical-color: #ef4444;
        }

        /* RESET & CORE */
        html, body, * { scrollbar-width: none !important; -ms-overflow-style: none !important; }
        *::-webkit-scrollbar { display: none !important; }
        
        body {
            background-color: #000;
            color: #000;
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
            height: 100vh; width: 100vw;
            margin: 0; padding: 0;
            cursor: none;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- VISUAL LAYERS --- */
        /* SCANLINES */
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 100;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.1) 50%, rgba(0,0,0,0.1));
            background-size: 100% 6px;
            animation: scan-drift 4s ease-in-out infinite alternate;
        }
        @keyframes scan-drift { 0% { background-position-y: 0px; } 100% { background-position-y: 20px; } }

        /* BLACKOUT CURTAIN */
        #blackout-curtain {
            position: fixed; inset: 0; background: black; z-index: 99999;
            transform: scale(1, 0); opacity: 0; pointer-events: none;
            transition: none; /* Controlled by animation classes */
        }
        .tv-off { animation: animOff 0.4s cubic-bezier(0.23, 1, 0.32, 1) forwards; pointer-events: all !important; }
        .tv-on { animation: animOn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; pointer-events: none !important; }

        @keyframes animOff {
            0% { transform: scale(1, 1); opacity: 0; }
            1% { opacity: 1; background: transparent; }
            50% { transform: scale(1, 0.02); background: white; opacity: 1; }
            100% { transform: scale(0, 0); background: black; opacity: 1; }
        }
        @keyframes animOn {
            0% { transform: scale(0.001, 0.001); background: white; opacity: 1; }
            60% { transform: scale(1, 0.01); background: white; opacity: 1; }
            100% { transform: scale(1, 1); background: transparent; opacity: 0; }
        }

        /* VIEWPORT */
        #viewport {
            position: relative; width: 100%; height: 100%;
            perspective: 1000px; background-color: #fff;
            transform-origin: center;
        }

        section.slide {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem 2rem; background: white;
            transition: transform 0.6s cubic-bezier(0.25, 1, 0.5, 1);
            will-change: transform;
        }
        .slide.past { transform: translateY(-100%); opacity: 0; }
        .slide.active { transform: translateY(0); opacity: 1; z-index: 10; }
        .slide.future { transform: translateY(100%); opacity: 0; }

        /* --- HUD --- */
        .hud-container {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 1400px; height: 40px;
            display: flex; align-items: center; gap: 0;
            z-index: 600; border: 2px solid black; background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .hud-label { background: black; color: white; height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; }
        .hud-track { flex-grow: 1; height: 100%; background: #e5e5e5; position: relative; overflow: hidden; }
        .hud-bar { height: 100%; width: 0%; background: var(--accent-color); position: relative; transition: width 1.5s cubic-bezier(0.22, 1, 0.36, 1); }
        .hud-bar.hazard-bg {
            background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.1), rgba(0,0,0,0.1) 10px, transparent 10px, transparent 20px);
            background-size: 28px 28px; animation: moveStripes 1s linear infinite;
        }
        @keyframes moveStripes { from { background-position: 0 0; } to { background-position: 56px 0; } }
        .hud-value { background: black; color: var(--accent-color); height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; min-width: 160px; justify-content: flex-end; }
        .page-counter { background: var(--accent-color); color: black; height: 100%; display: flex; align-items: center; padding: 0 12px; font-weight: 900; border-left: 2px solid black; }

        .narrative-container {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 800px;
            background: black; color: white; padding: 10px 20px;
            font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
            border-left: 4px solid var(--accent-color);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); z-index: 500;
        }
        .narrative-label { color: var(--accent-color); font-weight: bold; text-transform: uppercase; margin-right: 10px; }

        /* --- CARDS & UI --- */
        .brutalist-card {
            border: 3px solid black; background: white;
            box-shadow: 6px 6px 0px black; transition: transform 0.1s;
            cursor: pointer; overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        .brutalist-card.active-focus { transform: translate(-3px, -3px); box-shadow: 9px 9px 0px var(--accent-color); border-color: black; z-index: 20; }
        .card-icon { font-size: 4rem; background: #f3f4f6; flex-grow: 1; display: flex; align-items: center; justify-content: center; border-bottom: 3px solid black; }
        .card-content { padding: 1rem; background: white; }
        .bullet-list li { margin-bottom: 0.5rem; display: flex; align-items: flex-start; }
        .bullet-list li::before { content: ">>"; color: var(--accent-color); background: black; margin-right: 8px; padding: 0 4px; font-weight: bold; font-size: 0.8rem; }

        /* --- CHART & SMOKE --- */
        .victim-btn { border: 3px solid black; background: white; padding: 1rem; text-align: left; font-weight: bold; cursor: pointer; transition: all 0.2s; margin-bottom: 0.5rem; position: relative; }
        .victim-btn.active { background: black; color: var(--accent-color); border-color: black; transform: translate(4px, 0); box-shadow: -4px 0 0 var(--accent-color); }
        .roi-panel { background: #111; border: 2px solid var(--accent-color); color: var(--accent-color); padding: 0.5rem 1rem; font-family: 'JetBrains Mono', monospace; display: flex; flex-direction: column; justify-content: center; height: 80px; }
        .roi-panel.victim { border-color: #444; color: #666; }
        .roi-value { font-size: 2rem; font-weight: 800; line-height: 1; }
        .roi-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }

        .smoke-particle {
            position: fixed; width: 20px; height: 20px; background: #333;
            border-radius: 50%; pointer-events: none; z-index: 9000;
            animation: smokeRise 2s forwards; filter: blur(5px); opacity: 0;
        }
        @keyframes smokeRise {
            0% { transform: scale(0.5) translate(0, 0); opacity: 0.8; }
            100% { transform: scale(4) translate(50px, -150px); opacity: 0; }
        }

        /* --- CLOCK (GHOST TOWN) --- */
        #clock-wrapper { 
            position: relative; width: 400px; height: 400px; 
            transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        #clock-wrapper.broken { transform: rotate(20deg) translateY(150px); opacity: 0.8; pointer-events: none; }
        
        .clock-face {
            width: 100%; height: 100%; border: 8px solid #000; border-radius: 50%;
            position: relative; background: white; box-shadow: 15px 15px 0px rgba(0,0,0,0.1);
        }
        .crack-overlay {
            position: absolute; inset: 0; 
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50 50 L20 10 M50 50 L80 20 M50 50 L50 90 M30 40 L70 60' stroke='black' stroke-width='4' fill='none'/%3E%3C/svg%3E");
            opacity: 0; pointer-events: none; z-index: 60;
        }
        #clock-wrapper.broken .crack-overlay { opacity: 1; }

        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom center; background: black; }
        #hand-thin { width: 4px; height: 45%; margin-left: -2px; background: var(--critical-color); z-index: 10; }
        #hand-large { width: 8px; height: 35%; margin-left: -4px; z-index: 5; }
        
        .pov-sticker {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg) scale(0);
            background: #facc15; border: 4px solid black; padding: 20px;
            font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: 2rem;
            text-align: center; box-shadow: 10px 10px 0px rgba(0,0,0,0.5);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            z-index: 60;
        }
        .pov-sticker.visible { transform: translate(-50%, -50%) rotate(-10deg) scale(1); }

        .start-btn { cursor: pointer; transition: all 0.2s; }
        .start-btn.pressed { background-color: var(--accent-color); color: black; transform: scale(0.95); box-shadow: inset 4px 4px 0px rgba(0,0,0,0.2); }

        /* --- ZOOM OVERLAY --- */
        .zoom-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 5000;
            display: none; flex-direction: row; align-items: center; justify-content: center; gap: 2rem; padding: 2rem;
        }
        .zoom-overlay.active { display: flex; }
        
        #zoom-thumbs { display: flex; flex-direction: column; gap: 1rem; max-height: 80vh; overflow-y: auto; width: 100px; flex-shrink: 0; }
        .zoom-thumb { width: 80px; height: 80px; border: 2px solid #333; background: #111; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #666; cursor: pointer; transition: all 0.2s; }
        .zoom-thumb.active { border-color: var(--accent-color); color: white; background: #222; transform: scale(1.05); box-shadow: 4px 4px 0px var(--accent-color); }

        .zoom-content { flex-grow: 1; max-width: 1200px; aspect-ratio: 16/9; background: #111; border: 4px solid var(--accent-color); position: relative; display: flex; align-items: center; justify-content: center; }
        .play-indicator { font-size: 8rem; color: var(--accent-color); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.5; transform: scale(0.9); } }

        /* Winner UI */
        .winner-banner { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); z-index: 1000; align-items: center; justify-content: center; }
        .winner-frame { font-size: 10vw; font-weight: 900; border: 20px solid black; padding: 20px 60px; background: var(--accent-color); transform: rotate(-3deg); box-shadow: 10px 10px 0px black; width: fit-content; }
        
        /* VFX */
        .screen-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake { 0% { transform: translate(0, 0) rotate(0deg); } 20% { transform: translate(3px, 3px) rotate(1deg); } 40% { transform: translate(3px, -3px) rotate(1deg); } 60% { transform: translate(2px, 2px) rotate(0deg); } 80% { transform: translate(2px, -2px) rotate(-1deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
        .hero-badge { border: 4px solid black; background: white; padding: 8px 16px; font-weight: 800; font-family: 'JetBrains Mono', monospace; transform: rotate(-3deg); box-shadow: 4px 4px 0px rgba(0,0,0,0.2); margin-bottom: 2rem; }
        .instruction-toast { position: fixed; bottom: 80px; right: 20px; background: black; color: white; padding: 8px 12px; font-family: 'JetBrains Mono', monospace; font-size: 12px; opacity: 0; transition: opacity 0.3s; pointer-events: none; z-index: 20001; }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div id="blackout-curtain"></div>
    <div id="toast" class="instruction-toast">ACTION TRIGGERED</div>
    <div id="winner-ui" class="winner-banner"><div class="winner-frame">TEFQ WINS</div></div>

    <!-- ZOOM MODAL -->
    <div id="zoom-modal" class="zoom-overlay">
        <div id="zoom-thumbs"></div>
        <div class="zoom-content" id="zoom-frame">
            <div id="zoom-video-ui" class="flex flex-col items-center w-full h-full justify-center">
                <div id="zoom-icon" class="play-indicator">‚ñ∂</div>
                <div id="zoom-text" class="absolute top-4 left-4 font-mono text-white text-xl bg-black px-2">PLAYING FILE</div>
                <div class="absolute bottom-0 left-0 h-2 bg-yellow-400 w-0 transition-all duration-[5000ms] ease-linear" id="zoom-bar"></div>
            </div>
            <img id="zoom-img" src="" class="w-full h-full object-contain hidden" onerror="this.style.display='none'; document.getElementById('zoom-video-ui').style.display='flex';">
        </div>
    </div>

    <!-- NARRATIVE BAR -->
    <div class="narrative-container" id="narrative-ui">
        <div><span class="narrative-label">THREAD:</span> <span id="narrative-thread">LOADING...</span></div>
        <div class="text-gray-400" id="narrative-text">...</div>
    </div>

    <!-- HUD -->
    <div class="hud-container">
        <div class="hud-label">AUDIENCE STATUS</div>
        <div class="hud-track">
            <div id="jealousy-bar" class="hud-bar hazard-bg"></div>
        </div>
        <div id="jealousy-val" class="hud-value">0% JEALOUS</div>
        <div class="page-counter" id="page-counter">01 / 07</div>
    </div>

    <div id="viewport">
        <!-- 00. HERO -->
        <section id="slide-0" class="slide active" data-progress="10" data-thread="The Hook" data-narrative="You chose boring. We chose chaos.">
            <div class="hero-badge">ELECTIVES ANALYSIS v31.0</div>
            <h1 class="text-9xl font-black mb-2 tracking-tighter">TEFQ</h1>
            <h2 class="text-4xl font-thin text-gray-500">JUST TO MAKE YOU <span class="bg-yellow-400 text-black px-2 font-bold">JEALOUS</span>.</h2>
            <div class="mt-16 font-mono text-sm text-gray-400 animate-bounce">[PRESS DOWN TO BEGIN]</div>
        </section>

        <!-- 01. AGENDA -->
        <section id="slide-1" class="slide future" data-progress="20" data-thread="The Roadmap" data-narrative="We have categorized our superiority into 6 modules.">
            <div class="w-full max-w-5xl">
                <h3 class="text-6xl font-black mb-12 border-b-4 border-black pb-4">EVIDENCE LOCKER</h3>
                <div class="grid grid-cols-2 gap-8 font-mono text-sm">
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>01. HIGH ENERGY PHYSICS</strong><br>Fire, explosions, and near-death experiences.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>02. ACADEMIC SUPERIORITY</strong><br>Calculated Misery vs Empirical Efficiency.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>03. COMFORT OPS</strong><br>Food & Furniture.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>04. MEDIA DOMINANCE</strong><br>Clout, Content, and Primates.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>05. THE GHOST TOWN</strong><br>Why your life is sad.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>06. VERDICT</strong><br>Submission.</div>
                </div>
            </div>
        </section>

        <!-- 02. HIGH ENERGY -->
        <section id="slide-2" class="slide future" data-progress="35" data-thread="Module 01" data-narrative="PE students run. We create controlled disasters.">
            <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                <div class="col-span-4 flex flex-col justify-center h-full">
                    <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">HIGH ENERGY</h3>
                    <ul class="bullet-list space-y-4">
                        <li><strong>Safety Literacy:</strong> Survival skills.</li>
                        <li><strong>Magnesium Flare:</strong> Retina damage included.</li>
                        <li><strong>The Spill:</strong> "The Idiots with Fire".</li>
                        <li><strong>Leidenfrost Effect:</strong> Chaos in the lab.</li>
                    </ul>
                </div>
                <div class="col-span-8 grid grid-cols-2 gap-4 h-[60vh]">
                    <div class="brutalist-card interactive-item" data-media='[{"type":"video","src":"rainbow_flame.mp4","title":"Rainbow Fire"},{"type":"video","src":"magnesium.mp4","title":"Magnesium Flare"}]'>
                        <div class="multi-indicator">2 FILES</div>
                        <div class="card-icon text-6xl">üî•üåà</div>
                        <div class="card-content font-bold">Pyromania</div>
                    </div>
                    <div class="brutalist-card interactive-item" data-media='[{"type":"video","src":"spill.mp4","title":"The Spill"},{"type":"video","src":"leidenfrost.mp4","title":"Leidenfrost"}]'>
                        <div class="multi-indicator">2 FILES</div>
                        <div class="card-icon text-6xl">‚ö†Ô∏è</div>
                        <div class="card-content font-bold">Accidents</div>
                    </div>
                    <div class="brutalist-card interactive-item" data-media='[{"type":"video","src":"foam_bomb.mp4","title":"Foam Bomb"}]'>
                        <div class="card-icon text-6xl">üêòü´ß</div>
                        <div class="card-content font-bold">Foam Bomb</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 03. EFFICIENCY (ROI) -->
        <section id="slide-3" class="slide future" data-progress="50" data-thread="Module 02" data-narrative="Cake > Cardio. Efficiency is absolute.">
            <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                <div class="col-span-4">
                    <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">ACADEMIC ROI</h3>
                    <ul class="bullet-list space-y-4 mb-8">
                        <li><strong>Empirical Efficiency:</strong> Real reactions.</li>
                        <li><strong>Solution Prep:</strong> Mixing acid by hand.</li>
                        <li><strong>The "No 10" Rule:</strong> We eat grades.</li>
                    </ul>
                    <div class="interactive-group flex flex-col gap-2">
                        <div class="victim-btn active" id="btn-it">IT STUDENT</div>
                        <div class="victim-btn" id="btn-pe">PE STUDENT</div>
                        <div class="victim-btn" id="btn-psych">PSYCH STUDENT</div>
                        <div class="victim-btn" id="btn-french">FRENCH STUDENT</div>
                    </div>
                </div>
                <div class="col-span-8 flex flex-col gap-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div class="roi-panel"><div class="roi-label">TEFQ EFFICIENCY</div><div class="roi-value" id="tefq-roi">20.0x</div></div>
                        <div class="roi-panel victim" id="victim-panel"><div class="roi-label" id="victim-label">IT EFFICIENCY</div><div class="roi-value text-white" id="victim-roi">0.7x</div></div>
                    </div>
                    <div class="border-4 border-black bg-white p-4 shadow-[12px_12px_0px_#e5e7eb] h-[400px]">
                        <canvas id="dataChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- 04. COMFORT OPS -->
        <section id="slide-4" class="slide future" data-progress="65" data-thread="Module 03" data-narrative="We eat cake in cushioned chairs. Psych students cry on wood.">
            <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                <div class="col-span-4">
                    <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">COMFORT OPS</h3>
                    <ul class="bullet-list space-y-4">
                        <li><strong>Bio-Hacking:</strong> Edible stoichiometry.</li>
                        <li><strong>pH Analysis:</strong> Gum experiment.</li>
                        <li><strong>Infrastructure:</strong> The Chair Gap.</li>
                    </ul>
                </div>
                <div class="col-span-8 grid grid-cols-2 gap-8 h-[50vh]">
                    <div class="brutalist-card interactive-item" data-media='[{"type":"video","src":"mug_cake.mp4","title":"Mug Cake"},{"type":"image","src":"gum.png","title":"pH Gum"}]'>
                        <div class="multi-indicator">2 FILES</div>
                        <div class="card-icon text-8xl">üßÅ</div>
                        <div class="card-content font-bold">Consumables Protocol<br><span class="text-green-600">Grade: A+</span></div>
                    </div>
                    <div class="brutalist-card interactive-item" data-media='[{"type":"image","src":"chair_good.png","title":"TEFQ Throne"},{"type":"image","src":"chair_bad.png","title":"Wood Chair"}]'>
                        <div class="multi-indicator">2 FILES</div>
                        <div class="card-icon text-8xl">üõãÔ∏è</div>
                        <div class="card-content font-bold">The Throne vs The Wood<br><span class="text-yellow-500">Status: VIP</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 05. MEDIA & JOY -->
        <section id="slide-5" class="slide future" data-progress="80" data-thread="Module 04" data-narrative="We are the main characters. You are NPCs.">
            <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                <div class="col-span-4">
                    <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">MEDIA & JOY</h3>
                    <ul class="bullet-list space-y-4">
                        <li><strong>Valent√≠n:</strong> Dept. Head.</li>
                        <li><strong>Clout:</strong> School Instagram.</li>
                        <li><strong>Joy Optimization:</strong> Scissor Bubbles.</li>
                    </ul>
                </div>
                <div class="col-span-8 grid grid-cols-2 gap-8 h-[50vh]">
                    <div class="brutalist-card interactive-item" data-media='[{"type":"image","src":"instagram.png","title":"Viral Post"},{"type":"image","src":"valentin_tree.png","title":"Dept. Head"},{"type":"image","src":"valentin_screen.png","title":"Oversight"}]'>
                        <div class="multi-indicator">3 FILES</div>
                        <div class="card-icon text-8xl">üì∏</div>
                        <div class="card-content font-bold">Media Dominance</div>
                    </div>
                    <div class="brutalist-card interactive-item" data-media='[{"type":"image","src":"missing_evidence.png","title":"REDACTED"}]'>
                        <div class="card-icon text-8xl">‚úÇÔ∏èü´ß</div>
                        <div class="card-content font-bold">Scissor Bubbles<br><span class="text-red-500">EVIDENCE MISSING</span></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 06. GHOST TOWN -->
        <section id="slide-6" class="slide future" data-progress="95" data-thread="Module 05" data-narrative="A moment of silence for those who chose wrong.">
            
            <div class="w-full max-w-7xl grid grid-cols-2 gap-12 items-center">
                <!-- Left: List -->
                <div class="flex flex-col gap-6">
                    <h3 class="text-5xl font-black border-b-4 border-black pb-4">THE GHOST TOWN</h3>
                    <div class="interactive-group flex flex-col gap-4 font-mono">
                        <div class="p-6 border-4 border-gray-200 grayscale opacity-50"><h4 class="text-xl font-bold">IT: Handwritten SQL</h4></div>
                        <div class="p-6 border-4 border-gray-200 grayscale opacity-50"><h4 class="text-xl font-bold">PE: Thermal Shock</h4></div>
                        <div class="p-6 border-4 border-gray-200 grayscale opacity-50"><h4 class="text-xl font-bold">FRENCH: 404 Error</h4></div>
                    </div>
                    <div class="mt-4 bg-black text-white p-4 font-bold text-center blink-text interactive-item start-btn" id="silence-btn">
                        [ PRESS TAB FOR SILENCE ]
                    </div>
                </div>
                
                <!-- Right: Clock -->
                <div class="flex justify-center relative">
                    <div id="clock-wrapper">
                        <div class="clock-face">
                            <div class="crack-overlay"></div>
                            <div id="hand-thin" class="hand"></div>
                            <div id="hand-large" class="hand"></div>
                        </div>
                        <div id="pov-sticker" class="pov-sticker">
                            POV:<br>EST√ÅS EN CLASE<br>DE TEFQ
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 07. VERDICT -->
        <section id="slide-7" class="slide future" data-progress="100" data-thread="Victory" data-narrative="Press Alt for Verdict. Press Tab to Admit Defeat.">
            <h1 class="text-9xl font-black mb-8 animate-pulse text-red-600">FATAL ERROR</h1>
            <div class="p-12 border-8 border-red-600 bg-black text-white shadow-[12px_12px_0px_red] max-w-3xl text-center interactive-item active-focus">
                <p class="text-4xl font-bold text-red-500 mb-6">JEALOUSY OVERLOAD</p>
                <div class="bg-white text-black font-black text-6xl p-6 border-4 border-yellow-400 cursor-pointer hover:scale-105 transition">
                    [ ADMIT DEFEAT ]
                </div>
            </div>
        </section>
    </div>

    <!-- APP LOGIC -->
    <script>
        // --- CONFIG ---
        const dataConfig = {
            students: {
                it: { name: 'IT STUDENT', label: 'IT EFFICIENCY', suffering: 9, dignity: 2, grade: 5 },
                pe: { name: 'PE STUDENT', label: 'PE EFFICIENCY', suffering: 10, dignity: 4, grade: 8 },
                psych: { name: 'PSYCH STUDENT', label: 'PSYCH EFFICIENCY', suffering: 7, dignity: 5, grade: 6 },
                french: { name: 'FRENCH STUDENT', label: 'FRENCH EFFICIENCY', suffering: 8, dignity: 0, grade: 4 }
            },
            victimOrder: ['it', 'pe', 'psych', 'french'],
            tefq: { suffering: 1, dignity: 10, grade: 10 }
        };

        const appState = {
            currentSlide: 0,
            totalSlides: 8,
            interactionIndex: 0,
            
            // Sub-systems
            chartInstance: null,
            currentVictimIndex: 0,
            
            // Flags
            isZoomActive: false,
            isSystemOff: false,
            
            // Gallery
            slidePlaylist: [], // Array of objects {type, src, title}
            mediaIndex: 0,

            // Ghost Town
            ghostPhase: 0, // 0:Idle, 1:Normal, 2:Warp, 3:Done
            clockTime: 0,
            clockRaf: null,

            // Smoke
            smokeInterval: null,

            init: function() {
                // TV On
                document.getElementById('blackout-curtain').classList.add('tv-on');
                this.updateUI(0);
                this.generateClockTicks();
                setInterval(() => this.monitorJealousy(), 100);
            },

            // --- INPUT HANDLER (THE BRAIN) ---
            handleInput: function(key) {
                // Priority 1: Blackout Toggle (Always active)
                if (key === 'b' || key === 'B') {
                    this.toggleBlackout();
                    return;
                }

                if (this.isSystemOff) return; // Block input if off

                // Priority 2: Zoom Navigation
                if (this.isZoomActive) {
                    if (key === 'Tab') this.closeZoom();
                    else if (['ArrowDown', 'ArrowRight', 'PageDown'].includes(key)) this.cycleMedia(1);
                    else if (['ArrowUp', 'ArrowLeft', 'PageUp'].includes(key)) this.cycleMedia(-1);
                    return;
                }

                // Priority 3: Alt Key (Winner Banner)
                if (key === 'Alt' && this.currentSlide === 7) {
                    const banner = document.getElementById('winner-ui');
                    banner.style.display = (banner.style.display === 'flex') ? 'none' : 'flex';
                    return;
                }

                // Priority 4: Standard Navigation
                if (['ArrowDown', 'ArrowRight', 'PageDown'].includes(key)) this.changeSlide(1);
                else if (['ArrowUp', 'ArrowLeft', 'PageUp'].includes(key)) this.changeSlide(-1);
                else if (key === 'Tab') this.triggerAction();
            },

            toggleBlackout: function() {
                const curtain = document.getElementById('blackout-curtain');
                if (this.isSystemOff) {
                    // Turn ON
                    curtain.classList.remove('tv-off');
                    curtain.classList.add('tv-on');
                    this.isSystemOff = false;
                } else {
                    // Turn OFF
                    curtain.classList.remove('tv-on');
                    curtain.classList.add('tv-off');
                    this.isSystemOff = true;
                }
            },

            changeSlide: function(direction) {
                const newIndex = this.currentSlide + direction;
                if (newIndex < 0 || newIndex >= this.totalSlides) return;

                // Cleanup
                if (this.currentSlide === 3) this.stopSmoke();
                if (this.currentSlide === 6) this.resetGhostTown();

                this.currentSlide = newIndex;
                this.interactionIndex = 0;

                // DOM
                const slides = document.querySelectorAll('section.slide');
                slides.forEach((slide, i) => {
                    slide.classList.remove('active', 'past', 'future');
                    if (i < newIndex) slide.classList.add('past');
                    else if (i === newIndex) slide.classList.add('active');
                    else slide.classList.add('future');
                });

                this.updateUI(newIndex);
                this.updateFocus();

                // Triggers
                if (newIndex === 3) {
                    setTimeout(() => this.initChart(), 500);
                    this.startSmoke();
                }
            },

            updateUI: function(index) {
                const slide = document.getElementById(`slide-${index}`);
                const progress = parseFloat(slide.getAttribute('data-progress'));
                
                document.getElementById('narrative-thread').innerText = slide.getAttribute('data-thread');
                document.getElementById('narrative-text').innerText = slide.getAttribute('data-narrative');
                document.getElementById('page-counter').innerText = `0${index} / 07`;
                
                // Progress Bar
                const bar = document.getElementById('jealousy-bar');
                const num = document.getElementById('jealousy-val');
                bar.style.width = progress + '%';
                num.innerText = progress + '% JEALOUS';
            },

            monitorJealousy: function() {
                const bar = document.getElementById('jealousy-bar');
                const num = document.getElementById('jealousy-val');
                const viewport = document.getElementById('viewport');
                
                const parentWidth = bar.parentElement.clientWidth;
                const width = bar.clientWidth;
                const percent = (width / parentWidth) * 100;

                let color = 'var(--accent-color)';
                let shake = false;

                if (percent > 60) color = 'var(--danger-color)';
                if (percent >= 95) {
                    color = 'var(--critical-color)';
                    shake = true;
                }

                bar.style.backgroundColor = color;
                if (percent >= 99) num.style.color = 'var(--critical-color)';
                else num.style.color = 'var(--accent-color)';

                if (shake) viewport.classList.add('screen-shake');
                else viewport.classList.remove('screen-shake');
            },

            // --- ACTION TRIGGER ---
            triggerAction: function() {
                // Chart Swap
                if (this.currentSlide === 3) {
                    this.currentVictimIndex = (this.currentVictimIndex + 1) % dataConfig.victimOrder.length;
                    this.updateVictimChart(dataConfig.victimOrder[this.currentVictimIndex]);
                    return;
                }
                // Ghost Town
                if (this.currentSlide === 6) {
                    this.startGhostSequence();
                    return;
                }
                // Final Confetti
                if (this.currentSlide === 7) {
                    this.triggerConfetti();
                    return;
                }

                // Standard Interaction (Open Zoom)
                const items = document.querySelectorAll(`#slide-${this.currentSlide} .interactive-item`);
                if (items.length > 0) {
                    // Collect all media from the slide into a playlist
                    this.slidePlaylist = [];
                    items.forEach(item => {
                        if (item.dataset.media) {
                            const media = JSON.parse(item.dataset.media);
                            this.slidePlaylist = this.slidePlaylist.concat(media);
                        }
                    });
                    
                    // If media exists, open viewer at index 0 (or find clicked item's index if sophisticated, but 0 is safe)
                    if (this.slidePlaylist.length > 0) {
                        this.mediaIndex = 0;
                        this.openZoom();
                    }
                }
            },

            // --- MEDIA VIEWER (UNIFIED) ---
            openZoom: function() {
                this.isZoomActive = true;
                document.getElementById('zoom-modal').classList.add('active');
                this.renderZoom();
            },

            closeZoom: function() {
                this.isZoomActive = false;
                document.getElementById('zoom-modal').classList.remove('active');
            },

            cycleMedia: function(direction) {
                if (this.slidePlaylist.length === 0) return;
                
                if (direction === 1) this.mediaIndex = (this.mediaIndex + 1) % this.slidePlaylist.length;
                else this.mediaIndex = (this.mediaIndex - 1 + this.slidePlaylist.length) % this.slidePlaylist.length;
                
                this.renderZoom();
            },

            renderZoom: function() {
                const item = this.slidePlaylist[this.mediaIndex];
                const videoUI = document.getElementById('zoom-video-ui');
                const imgUI = document.getElementById('zoom-img');
                const text = document.getElementById('zoom-text');
                const thumbs = document.getElementById('zoom-thumbs');

                // Thumbs
                thumbs.innerHTML = '';
                this.slidePlaylist.forEach((m, i) => {
                    const t = document.createElement('div');
                    t.className = `zoom-thumb ${i === this.mediaIndex ? 'active' : ''}`;
                    t.innerText = i + 1;
                    thumbs.appendChild(t);
                });

                // Content
                if (item.title === 'REDACTED') {
                    videoUI.style.display = 'flex'; imgUI.style.display = 'none';
                    document.getElementById('zoom-icon').innerText = 'üö´';
                    text.innerText = "ERROR: EVIDENCE REDACTED";
                    text.className = "absolute top-4 left-4 font-mono text-red-500 text-xl bg-black px-2 blink-text";
                    return;
                }

                text.className = "absolute top-4 left-4 font-mono text-white text-xl bg-black px-2";
                
                if (item.type === 'video') {
                    videoUI.style.display = 'flex'; imgUI.style.display = 'none';
                    document.getElementById('zoom-icon').innerText = '‚ñ∂';
                    text.innerText = `PLAYING: ${item.title}`;
                    
                    const bar = document.getElementById('zoom-bar');
                    bar.style.width = '0%'; bar.style.transition = 'none';
                    setTimeout(() => { bar.style.transition = 'width 5s linear'; bar.style.width = '100%'; }, 50);
                } else {
                    videoUI.style.display = 'none'; imgUI.style.display = 'block';
                    imgUI.src = item.src;
                    imgUI.onerror = function() {
                        this.style.display='none'; videoUI.style.display='flex';
                        document.getElementById('zoom-icon').innerText = 'üñºÔ∏è';
                    };
                }
            },

            // --- CHART & SMOKE ---
            spawnSmoke: function() {
                const activeBtn = document.querySelector('.victim-btn.active');
                if (!activeBtn) return;
                const rect = activeBtn.getBoundingClientRect();
                
                const p = document.createElement('div');
                p.classList.add('smoke-particle');
                
                // Right side center
                const size = Math.random() * 20 + 15;
                p.style.width = `${size}px`; p.style.height = `${size}px`;
                p.style.left = `${rect.right - 10}px`;
                p.style.top = `${rect.top + (rect.height/2) - 10}px`;
                p.style.setProperty('--drift', (Math.random() - 0.5) * 50 + 'px');
                
                document.body.appendChild(p);
                setTimeout(() => p.remove(), 2500);
            },
            
            startSmoke: function() {
                if (this.smokeInterval) clearInterval(this.smokeInterval);
                this.smokeInterval = setInterval(() => this.spawnSmoke(), 200);
            },
            stopSmoke: function() { if (this.smokeInterval) clearInterval(this.smokeInterval); },

            updateVictimChart: function(key) {
                document.querySelectorAll('.victim-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`btn-${key}`).classList.add('active');
                
                this.spawnSmoke(); // Feedback

                const data = dataConfig.students[key];
                if (this.chartInstance) {
                    this.chartInstance.data.datasets[1].label = data.name;
                    this.chartInstance.data.datasets[1].data = [data.suffering, data.dignity, data.grade];
                    this.chartInstance.update();
                }
                
                const roi = ((data.grade + data.dignity) / data.suffering).toFixed(1);
                document.getElementById('victim-label').innerText = data.label;
                document.getElementById('victim-roi').innerText = roi + "x";
            },

            initChart: function() {
                const ctx = document.getElementById('dataChart');
                if (!ctx || this.chartInstance) return;
                
                Chart.defaults.font.family = 'JetBrains Mono';
                Chart.defaults.color = '#000';
                
                this.chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['SUFFERING', 'DIGNITY', 'GRADE'],
                        datasets: [
                            { label: 'TEFQ', data: [1, 10, 10], backgroundColor: '#facc15', borderWidth: 3, borderColor: 'black' },
                            { label: 'IT STUDENT', data: [9, 2, 5], backgroundColor: '#000000', borderWidth: 0 }
                        ]
                    },
                    options: {
                        responsive: true, maintainAspectRatio: false,
                        animation: { duration: 1000, easing: 'easeOutElastic' }
                    }
                });
            },

            // --- GHOST TOWN ---
            generateClockTicks: function() {
                const face = document.querySelector('.clock-face');
                for(let i=0; i<60; i++) {
                    const tick = document.createElement('div');
                    tick.style.position = 'absolute';
                    tick.style.width = i % 5 === 0 ? '4px' : '2px';
                    tick.style.height = i % 5 === 0 ? '15px' : '8px';
                    tick.style.background = 'black';
                    tick.style.top = '10px';
                    tick.style.left = '50%';
                    tick.style.transformOrigin = '0 142px';
                    tick.style.transform = `rotate(${i * 6}deg)`;
                    face.appendChild(tick);
                }
            },

            startGhostSequence: function() {
                if (this.ghostPhase !== 0) return;
                this.ghostPhase = 1;
                document.getElementById('silence-btn').classList.add('pressed');
                document.getElementById('silence-btn').innerText = "[ TIME DILATING... ]";

                let lastTime = performance.now();
                this.clockTime = 0;

                const loop = (now) => {
                    if (this.currentSlide !== 6 || this.ghostPhase === 0) return; // Exit condition

                    const delta = (now - lastTime) / 1000;
                    lastTime = now;

                    let speed = 1;
                    if (this.ghostPhase === 1) { // Normal
                        speed = 1;
                        if (this.clockTime > 5) {
                            this.ghostPhase = 2; // Warp
                            document.getElementById('pov-sticker').classList.add('visible');
                        }
                    } else if (this.ghostPhase === 2) { // Warp
                        speed += (this.clockTime * 0.5); // Accel
                    }

                    if (this.ghostPhase !== 3) {
                        this.clockTime += delta * speed;
                        
                        const thin = document.getElementById('hand-thin');
                        const large = document.getElementById('hand-large');
                        
                        // Thin: 1 rot/sec = 360deg/sec
                        thin.style.transform = `rotate(${this.clockTime * 360}deg)`;
                        // Large: 1 rot/min = 6deg/sec
                        large.style.transform = `rotate(${this.clockTime * 6}deg)`;

                        if (this.clockTime >= 60) {
                            this.ghostPhase = 3; // Crash
                            document.getElementById('clock-wrapper').classList.add('broken');
                        }
                    }
                    requestAnimationFrame(loop);
                };
                requestAnimationFrame(loop);
            },

            resetGhostTown: function() {
                this.ghostPhase = 0;
                this.clockTime = 0;
                document.getElementById('hand-thin').style.transform = 'rotate(0deg)';
                document.getElementById('hand-large').style.transform = 'rotate(0deg)';
                document.getElementById('pov-sticker').classList.remove('visible');
                document.getElementById('clock-wrapper').classList.remove('broken');
                document.getElementById('silence-btn').classList.remove('pressed');
                document.getElementById('silence-btn').innerText = "[ PRESS TAB FOR SILENCE ]";
            },

            // --- CONFETTI ---
            triggerConfetti: function() {
                const colors = ['#000', '#facc15'];
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 }, colors: colors, zIndex: 999 });
            },

            updateFocus: function() {
                document.querySelectorAll('.active-focus').forEach(el => el.classList.remove('active-focus'));
                const items = document.querySelectorAll(`#slide-${this.currentSlide} .interactive-item`);
                if (items.length > 0) items[0].classList.add('active-focus');
            }
        };

        document.addEventListener('keydown', (e) => appState.handleInput(e.key));
        window.onload = () => appState.init();

    </script>
</body>
</html>

