<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEFQ: Jealousy Engine v15.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;800&display=swap');

        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #facc15;
            --danger-color: #f97316;
            --critical-color: #ef4444;
        }

        body {
            background-color: #000; /* Black background for CRT effect */
            color: var(--text-color);
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- CRT ANIMATIONS (Applied to Viewport) --- */
        #viewport {
            position: relative; width: 100%; height: 100%;
            perspective: 1000px;
            background-color: var(--bg-color);
            transform-origin: center;
        }

        /* Turn ON */
        .crt-on { animation: turnOn 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        @keyframes turnOn {
            0% { transform: scale(0, 0); filter: brightness(0); }
            30% { transform: scale(1, 0.005); filter: brightness(5); }
            60% { transform: scale(1, 0.005); filter: brightness(2); }
            100% { transform: scale(1, 1); filter: brightness(1); }
        }

        /* Turn OFF */
        .crt-off { animation: turnOff 0.5s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        @keyframes turnOff {
            0% { transform: scale(1, 1); filter: brightness(1); }
            40% { transform: scale(1, 0.005); filter: brightness(3); }
            70% { transform: scale(1, 0.005); filter: brightness(5); }
            100% { transform: scale(0, 0); filter: brightness(0); }
        }

        /* --- SLIDE --- */
        section.slide {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem 2rem; background: white;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1.000);
            will-change: transform;
        }
        .slide.past { transform: translateY(-100%); z-index: 0; }
        .slide.active { transform: translateY(0); z-index: 10; }
        .slide.future { transform: translateY(100%); z-index: 20; }

        /* --- UI ELEMENTS --- */
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 900;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.05));
            background-size: 100% 4px;
        }
        .scanlines::before {
            content: " "; display: block; position: absolute; inset: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.02) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.03), rgba(0, 255, 0, 0.01), rgba(0, 0, 255, 0.03));
            background-size: 100% 2px, 3px 100%;
        }

        .narrative-box {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 800px;
            background: black; color: white; padding: 10px 20px;
            font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
            border-left: 4px solid var(--accent-color);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2); z-index: 50;
        }
        .narrative-label { color: var(--accent-color); font-weight: bold; text-transform: uppercase; margin-right: 10px; }

        .hud-container {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 1400px; height: 40px;
            display: flex; align-items: center; gap: 0;
            z-index: 100; font-family: 'JetBrains Mono', monospace;
            border: 2px solid black; background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .hud-label { background: black; color: white; height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; }
        .hud-track { flex-grow: 1; height: 100%; background: #e5e5e5; position: relative; overflow: hidden; }
        .hud-bar { height: 100%; width: 0%; background: var(--accent-color); position: relative; }
        .hud-bar.leap { transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1); }
        .hud-bar.creep { transition: width 4s linear; }
        .hud-bar.hazard-bg {
            background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.1), rgba(0,0,0,0.1) 10px, transparent 10px, transparent 20px);
            background-size: 28px 28px; animation: moveStripes 1s linear infinite;
        }
        @keyframes moveStripes { from { background-position: 0 0; } to { background-position: 56px 0; } }
        .hud-value { background: black; color: var(--accent-color); height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; min-width: 160px; justify-content: flex-end; }

        .brutalist-card {
            border: 3px solid black; background: white;
            box-shadow: 6px 6px 0px black; transition: transform 0.1s;
            cursor: pointer; overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        .brutalist-card:hover, .brutalist-card.active-focus {
            transform: translate(-3px, -3px);
            box-shadow: 9px 9px 0px var(--accent-color);
            border-color: black; z-index: 20;
        }
        
        .victim-btn {
            border: 3px solid black; background: white; padding: 1rem;
            text-align: left; font-weight: bold; cursor: pointer;
            transition: all 0.2s; margin-bottom: 0.5rem;
        }
        .victim-btn:hover { background: #f3f4f6; }
        .victim-btn.active {
            background: black; color: var(--accent-color);
            border-color: black; transform: translate(4px, 0);
            box-shadow: -4px 0 0 var(--accent-color);
        }

        .card-icon { font-size: 4rem; background: #f3f4f6; flex-grow: 1; display: flex; align-items: center; justify-content: center; border-bottom: 3px solid black; }
        .card-content { padding: 1rem; background: white; }
        .hazard-stripe {
            background: repeating-linear-gradient(45deg, #facc15, #facc15 10px, #000 10px, #000 20px);
            height: 8px; width: 100%; border-bottom: 3px solid black;
        }

        .zoom-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 999; display: none; flex-direction: column;
            align-items: center; justify-content: center;
        }
        .zoom-overlay.active { display: flex; }
        .zoom-content {
            width: 85vw; max-width: 1200px; aspect-ratio: 16/9;
            background: #111; border: 4px solid var(--accent-color);
            position: relative; display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 100px rgba(250, 204, 21, 0.3);
        }
        .play-indicator { font-size: 8rem; color: var(--accent-color); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 50% { opacity: 1; transform: scale(1.1); } 100% { opacity: 0.5; transform: scale(0.9); } }
        
        .zoom-thumb {
            width: 60px; height: 60px; border: 2px solid #444; background: #111;
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: #666; cursor: pointer; transition: all 0.2s;
        }
        .zoom-thumb.active { border-color: var(--accent-color); color: white; transform: scale(1.1); box-shadow: 0 0 15px rgba(250, 204, 21, 0.5); }

        .screen-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-2px, 0, 0); }
            40%, 60% { transform: translate3d(2px, 0, 0); }
        }
        
        .winner-banner {
            display: none; position: fixed; inset: 0; background: rgba(250, 204, 21, 0.95);
            z-index: 5000; align-items: center; justify-content: center;
        }
        .winner-frame {
            font-size: 10vw; font-weight: 900; 
            border: 20px solid black; padding: 20px 40px;
            background: transparent;
            transform: rotate(-3deg);
            box-shadow: 0 0 0 10px #facc15, 0 0 0 20px black;
            width: fit-content;
        }
        
        .blink-text { animation: blinker 0.2s linear infinite; color: red; }
        @keyframes blinker { 50% { opacity: 0; } }

        .hero-badge {
            border: 4px solid black; background: white; padding: 8px 16px;
            font-weight: 800; font-family: 'JetBrains Mono', monospace;
            transform: rotate(-3deg); box-shadow: 4px 4px 0px rgba(0,0,0,0.2); margin-bottom: 2rem;
        }

        .instruction-toast {
            position: fixed; bottom: 80px; right: 20px;
            background: black; color: white; padding: 8px 12px;
            font-family: 'JetBrains Mono', monospace; font-size: 12px;
            opacity: 0; transition: opacity 0.3s; pointer-events: none;
        }
    </style>
</head>
<body>

    <div class="scanlines"></div>
    <div id="toast" class="instruction-toast">ACTION TRIGGERED</div>
    
    <!-- WINNER UI -->
    <div id="winner-ui" class="winner-banner">
        <div class="winner-frame">TEFQ WINS</div>
    </div>

    <!-- ZOOM MODAL -->
    <div id="zoom-modal" class="zoom-overlay">
        <div class="zoom-content" id="zoom-frame">
            <div id="zoom-video-ui" class="flex flex-col items-center w-full h-full justify-center">
                <div id="zoom-icon" class="play-indicator">‚ñ∂</div>
                <div id="zoom-text" class="absolute top-4 left-4 font-mono text-white text-xl bg-black px-2">PLAYING FILE</div>
                <div class="absolute bottom-0 left-0 h-2 bg-yellow-400 w-0 transition-all duration-[5000ms] ease-linear" id="zoom-bar"></div>
            </div>
            <img id="zoom-img" src="" class="w-full h-full object-contain hidden" onerror="this.style.display='none'; document.getElementById('zoom-video-ui').style.display='flex';">
        </div>
        <div id="zoom-thumbs" class="flex gap-4 mt-6"></div>
        <div class="text-white font-mono mt-4 text-sm">[USE ARROWS TO SWITCH | TAB TO CLOSE]</div>
    </div>

    <!-- HUD -->
    <div class="hud-container">
        <div class="hud-label">AUDIENCE STATUS</div>
        <div class="hud-track">
            <div id="jealousy-bar" class="hud-bar hazard-bg"></div>
        </div>
        <div id="jealousy-val" class="hud-value">0% JEALOUS</div>
    </div>

    <div id="viewport" class="crt-on">
        <!-- 00. HERO -->
        <section id="slide-0" class="slide active" data-base="0" data-cap="10">
            <div class="hero-badge">ELECTIVES ANALYSIS v15.0</div>
            <h1 class="text-9xl font-black mb-2 tracking-tighter">TEFQ</h1>
            <h2 class="text-4xl font-thin text-gray-500">JUST TO MAKE YOU <span class="bg-yellow-400 text-black px-2 font-bold">JEALOUS</span>.</h2>
            <div class="mt-16 font-mono text-sm text-gray-400 animate-bounce">[PRESS DOWN TO BEGIN]</div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> The Hook</div>
                <div class="text-gray-400">"You chose boring. We chose chaos."</div>
            </div>
        </section>

        <!-- 01. AGENDA -->
        <section id="slide-1" class="slide future" data-base="10" data-cap="20">
            <div class="w-full max-w-5xl">
                <h3 class="text-6xl font-black mb-12 border-b-4 border-black pb-4">EVIDENCE LOCKER</h3>
                <div class="grid grid-cols-2 gap-8 font-mono text-sm">
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>01. DANGER</strong><br>Fire & Explosions.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>02. HARD DATA</strong><br>Graphs proving superiority.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>03. BIO-HACKING</strong><br>Food & Comfort.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>04. JOY</strong><br>Bubbles & Pranks.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>05. THE OTHERS</strong><br>Why your life is sad.</div>
                    <div class="p-4 border-l-8 border-black bg-gray-50"><strong>06. VERDICT</strong><br>Submission.</div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> The Roadmap</div>
                <div class="text-gray-400">"We have categorized our superiority into 6 modules."</div>
            </div>
        </section>

        <!-- 02. DANGER -->
        <section id="slide-2" class="slide future" data-base="20" data-cap="35">
            <div class="w-full max-w-7xl">
                <div class="flex items-center mb-6 border-b-4 border-black pb-2">
                    <h3 class="text-4xl font-bold uppercase">01. Danger Protocol</h3>
                    <span class="ml-auto font-mono text-xs bg-yellow-400 px-2 py-1 border border-black">CLICK TO PLAY</span>
                </div>
                <div class="grid grid-cols-3 gap-6 h-[400px]">
                    <div class="brutalist-card interactive-item" onclick="triggerZoom('video', 'üî•', 'RAINBOW FIRE', 'rainbow.mp4')">
                        <div class="card-icon text-7xl">üåà</div>
                        <div class="card-content"><h4 class="font-bold">Rainbow Fire</h4><p class="text-xs text-gray-500 font-mono">Emission Spectrums.</p></div>
                    </div>
                    <div class="brutalist-card interactive-item" onclick="triggerZoom('video', 'üí•', 'MAGNESIUM', 'magnesium.mp4')">
                        <div class="card-icon text-7xl">üí•</div>
                        <div class="card-content"><h4 class="font-bold">Magnesium Flare</h4><p class="text-xs text-gray-500 font-mono">Retina damage.</p></div>
                    </div>
                    <div class="brutalist-card interactive-item" onclick="triggerZoom('video', '‚ö†Ô∏è', 'THE SPILL', 'spill.mp4')">
                        <div class="card-icon text-7xl">üß™</div>
                        <div class="card-content"><h4 class="font-bold">The Spill</h4><p class="text-xs text-gray-500 font-mono">Near death experience.</p></div>
                    </div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> Spectacle</div>
                <div class="text-gray-400">"PE students run. We create controlled disasters."</div>
            </div>
        </section>

        <!-- 03. HARD DATA -->
        <section id="slide-3" class="slide future" data-base="35" data-cap="50">
            <div class="w-full max-w-6xl">
                <div class="flex items-center mb-4 border-b-4 border-black pb-2">
                    <h3 class="text-4xl font-bold uppercase">02. Hard Data</h3>
                    <span class="ml-auto font-mono text-xs bg-yellow-400 px-2 py-1 border border-black">SELECT VICTIM</span>
                </div>
                <div class="flex gap-8 items-start h-[500px]">
                    <div class="w-1/4 flex flex-col interactive-group">
                        <h4 class="font-mono font-bold text-sm mb-4">COMPARE TEFQ VS:</h4>
                        <button class="victim-btn interactive-item active" id="btn-it" onclick="updateVictimChart('it')">IT STUDENT</button>
                        <button class="victim-btn interactive-item" id="btn-pe" onclick="updateVictimChart('pe')">PE STUDENT</button>
                        <button class="victim-btn interactive-item" id="btn-psych" onclick="updateVictimChart('psych')">PSYCH STUDENT</button>
                        <button class="victim-btn interactive-item" id="btn-french" onclick="updateVictimChart('french')">FRENCH STUDENT</button>
                    </div>
                    <div class="w-3/4 h-full border-4 border-black bg-white p-4 shadow-[12px_12px_0px_#e5e7eb]">
                        <canvas id="dataChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> The Receipts</div>
                <div class="text-gray-400">"We break ‚Ç¨450/month. We still get 10s. Do the math."</div>
            </div>
        </section>

        <!-- 04. BIO-HACKING -->
        <section id="slide-4" class="slide future" data-base="50" data-cap="70">
            <div class="w-full max-w-7xl">
                <div class="flex items-center mb-6 border-b-4 border-black pb-2">
                    <h3 class="text-4xl font-bold uppercase">03. Bio-Hacking</h3>
                    <span class="ml-auto font-mono text-xs bg-yellow-400 px-2 py-1 border border-black">CLICK TO ZOOM</span>
                </div>
                <div class="grid grid-cols-2 gap-8 h-[400px]">
                    <div class="brutalist-card interactive-item" onclick="triggerZoom('video', 'üßÅ', 'MUG CAKE', 'mug_cake.mp4')">
                        <div class="card-icon text-8xl">üßÅ</div>
                        <div class="card-content flex justify-between">
                            <div><h4 class="font-bold">Mug Cake</h4><p class="text-xs font-mono">Stoichiometry you can eat.</p></div>
                            <div class="text-4xl font-bold text-green-600">A+</div>
                        </div>
                    </div>
                    <div class="brutalist-card interactive-item" onclick="triggerZoom('image', null, 'THE THRONE', 'chair_good.png')">
                        <div class="card-icon text-8xl">üõãÔ∏è</div>
                        <div class="card-content flex justify-between">
                            <div><h4 class="font-bold">The Throne</h4><p class="text-xs font-mono">Padded. Spinning. Height Adj.</p></div>
                            <div class="text-4xl font-bold text-yellow-500">VIP</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> Lifestyle</div>
                <div class="text-gray-400">"We eat cake in cushioned chairs. Psych students cry on wood."</div>
            </div>
        </section>

        <!-- 05. JOY -->
        <section id="slide-5" class="slide future" data-base="70" data-cap="85">
            <div class="w-full max-w-4xl text-center">
                <h3 class="text-4xl font-bold uppercase mb-8">04. Joy Optimization</h3>
                <div class="brutalist-card p-12 interactive-item mx-auto max-w-2xl bg-yellow-400" onclick="triggerZoom('image', null, 'SCISSOR BUBBLES', 'missing_evidence.png')">
                    <div class="text-9xl mb-4">‚úÇÔ∏èü´ß</div>
                    <h2 class="text-5xl font-black mb-2">SCISSOR BUBBLES</h2>
                    <p class="font-mono text-xl">Blowing bubbles through scissor handles while doing dishes.</p>
                    <div class="mt-4 bg-black text-white inline-block px-4 py-2 font-mono text-sm border-2 border-white">EVIDENCE REDACTED (ZOOM)</div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> The Ultimate Flex</div>
                <div class="text-gray-400">"Even our chores are fun. Your whole life is boring."</div>
            </div>
        </section>

        <!-- 06. THE OTHERS -->
        <section id="slide-6" class="slide future" data-base="85" data-cap="96">
            <div class="w-full max-w-6xl">
                <h3 class="text-4xl font-bold uppercase mb-12 border-b-4 border-black pb-4">05. The Ghost Town</h3>
                <div class="grid grid-cols-3 gap-8 text-center font-mono">
                    <div class="p-8 border-4 border-gray-200 grayscale opacity-50 interactive-item">
                        <h4 class="text-2xl font-bold text-gray-400">IT</h4>
                        <p class="text-sm mt-2">Handwritten SQL.<br>Sadness.</p>
                    </div>
                    <div class="p-8 border-4 border-gray-200 grayscale opacity-50 interactive-item">
                        <h4 class="text-2xl font-bold text-gray-400">PE</h4>
                        <p class="text-sm mt-2">Sweat.<br>Regret.</p>
                    </div>
                    <div class="p-8 border-4 border-gray-200 grayscale opacity-50 interactive-item">
                        <h4 class="text-2xl font-bold text-gray-400">FRENCH</h4>
                        <p class="text-sm mt-2">404 Error.<br>NPC Activity.</p>
                    </div>
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> Contrast</div>
                <div class="text-gray-400">"A moment of silence for those who chose wrong."</div>
            </div>
        </section>

        <!-- 07. END -->
        <section id="slide-7" class="slide future" data-base="96" data-cap="100">
            <h1 class="text-8xl font-black mb-6 blink-text">FATAL ERROR</h1>
            <div class="p-8 border-8 border-red-600 bg-black text-white shadow-[12px_12px_0px_red] max-w-2xl text-center interactive-item active-focus">
                <p class="text-2xl font-bold text-red-500 mb-4">JEALOUSY OVERLOAD</p>
                <div class="bg-white text-black font-black text-4xl p-4 border-4 border-yellow-400 cursor-pointer hover:scale-105 transition" onclick="triggerConfetti()">
                    [ ADMIT DEFEAT ]
                </div>
            </div>
            <div class="narrative-box">
                <div><span class="narrative-label">THREAD:</span> Victory</div>
                <div class="text-gray-400">"Press Alt for Verdict. Click to accept."</div>
            </div>
        </section>
    </div>

    <!-- LOGIC -->
    <script>
        // --- DATA ---
        const studentProfiles = {
            it: { name: 'IT STUDENT', label: 'IT', effort: 9, joy: 1 },
            pe: { name: 'PE STUDENT', label: 'PE', effort: 8, joy: 2 },
            psych: { name: 'PSYCH STUDENT', label: 'PSYCH', effort: 7, joy: 3 },
            french: { name: 'FRENCH STUDENT', label: 'FRENCH', effort: 6, joy: 0 }
        };
        const tefqStats = { effort: 2, joy: 10 };

        // --- STATE ---
        let currentSlideIndex = 0;
        const totalSlides = 8;
        let chartInstance = null;
        let currentVictim = 'it';
        let interactionIndex = 0;
        let blackoutState = false;
        let zoomIndex = 0; // Track item in zoom mode

        // --- SLIDE NAVIGATION ---
        function goToSlide(index) {
            if (index < 0 || index >= totalSlides) return;
            if (document.getElementById('zoom-modal').classList.contains('active')) return;

            const slides = document.querySelectorAll('section.slide');
            slides.forEach((slide, i) => {
                slide.classList.remove('active', 'past', 'future');
                if (i < index) slide.classList.add('past');
                else if (i === index) slide.classList.add('active');
                else slide.classList.add('future');
            });

            currentSlideIndex = index;
            interactionIndex = 0;
            updateInteractionFocus();

            const activeSlide = document.getElementById(`slide-${index}`);
            const base = parseFloat(activeSlide.getAttribute('data-base'));
            const cap = parseFloat(activeSlide.getAttribute('data-cap'));
            
            updateJealousy(base, cap);

            if (index === 3) setTimeout(() => initChart(), 500);
        }

        // --- JEALOUSY METER ---
        function updateJealousy(base, cap) {
            const bar = document.getElementById('jealousy-bar');
            const num = document.getElementById('jealousy-val');
            
            bar.className = 'hud-bar hazard-bg'; 
            document.body.classList.remove('screen-shake');
            bar.style.backgroundColor = 'var(--accent-color)';
            
            setTimeout(() => {
                bar.classList.add('leap');
                bar.style.width = base + '%';
                num.innerText = Math.round(base) + '% JEALOUS';
            }, 10);

            setTimeout(() => {
                bar.classList.remove('leap');
                bar.classList.add('creep');
                bar.style.width = cap + '%';
                animateNumber(base, cap, 4000);

                if (cap >= 95) {
                    setTimeout(() => {
                        bar.style.backgroundColor = 'var(--critical-color)';
                        document.body.classList.add('screen-shake');
                    }, 3000);
                }
            }, 550);
        }

        function animateNumber(start, end, duration) {
            const num = document.getElementById('jealousy-val');
            const startTime = performance.now();
            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                const current = start + (end - start) * progress;
                num.innerText = Math.round(current) + '% JEALOUS';
                if (Math.round(current) === 100) num.style.color = 'var(--critical-color)';
                else num.style.color = 'var(--accent-color)';
                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        // --- CHART ---
        function initChart() {
            const ctx = document.getElementById('dataChart');
            if (!ctx || chartInstance) return;
            
            Chart.defaults.font.family = 'JetBrains Mono';
            Chart.defaults.font.size = 14;
            Chart.defaults.color = '#000';

            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['EFFORT (Lower is Better)', 'JOY (Higher is Better)'],
                    datasets: [
                        { label: 'TEFQ', data: [tefqStats.effort, tefqStats.joy], backgroundColor: '#facc15', borderWidth: 3, borderColor: 'black' },
                        { label: studentProfiles[currentVictim].name, data: [studentProfiles[currentVictim].effort, studentProfiles[currentVictim].joy], backgroundColor: '#000000', borderWidth: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'top', labels: { font: { weight: 'bold' } } } },
                    scales: { y: { beginAtZero: true, max: 10, grid: { color: '#f3f4f6' } }, x: { grid: { display: false }, ticks: { font: { weight: 'bold' } } } },
                    animation: { duration: 500 }
                }
            });
        }

        function updateVictimChart(victimId) {
            document.querySelectorAll('.victim-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${victimId}`).classList.add('active');
            currentVictim = victimId;
            if (!chartInstance) initChart();
            else {
                const victim = studentProfiles[victimId];
                chartInstance.data.datasets[1].label = victim.name;
                chartInstance.data.datasets[1].data = [victim.effort, victim.joy];
                chartInstance.update();
            }
        }

        // --- TAB INTERACTION ---
        function triggerAction() {
            const currentSlideEl = document.getElementById(`slide-${currentSlideIndex}`);
            const items = currentSlideEl.querySelectorAll('.interactive-item');

            if (currentSlideIndex === 7) { triggerConfetti(); return; }

            if (items.length > 0) {
                // Determine item index in list
                if (interactionIndex >= items.length) interactionIndex = 0;
                items[interactionIndex].click();
            }
        }

        function updateInteractionFocus() {
            document.querySelectorAll('.active-focus').forEach(el => el.classList.remove('active-focus'));
            const currentSlideEl = document.getElementById(`slide-${currentSlideIndex}`);
            const items = currentSlideEl.querySelectorAll('.interactive-item');
            if (items.length > 0) {
                if (interactionIndex >= items.length) interactionIndex = 0;
                items[interactionIndex].classList.add('active-focus');
            }
        }

        // --- ZOOM & NAVIGATION ---
        function triggerZoom(type, icon, title, src) {
            const modal = document.getElementById('zoom-modal');
            const videoUI = document.getElementById('zoom-video-ui');
            const imgUI = document.getElementById('zoom-img');
            const iconEl = document.getElementById('zoom-icon');
            const textEl = document.getElementById('zoom-text');
            const bar = document.getElementById('zoom-bar');
            
            // Build Thumbnails
            const thumbsContainer = document.getElementById('zoom-thumbs');
            thumbsContainer.innerHTML = '';
            const slideItems = document.querySelectorAll(`#slide-${currentSlideIndex} .interactive-item`);
            
            slideItems.forEach((item, idx) => {
                let itemIcon = item.querySelector('.card-icon')?.innerText;
                if (!itemIcon) {
                    const bigText = item.querySelector('.text-8xl, .text-9xl, .text-7xl');
                    if (bigText) itemIcon = bigText.innerText;
                }
                
                if (itemIcon) {
                    const thumb = document.createElement('div');
                    thumb.className = 'zoom-thumb';
                    thumb.innerText = itemIcon;
                    const itemTitle = item.querySelector('h4, h2')?.innerText?.toUpperCase() || '';
                    if (itemTitle.includes(title) || itemIcon === icon) {
                        thumb.classList.add('active');
                        zoomIndex = idx; // Update zoom index to current item
                    }
                    thumbsContainer.appendChild(thumb);
                }
            });

            modal.classList.add('active');

            if (title === 'SCISSOR BUBBLES') {
                videoUI.style.display = 'flex'; imgUI.style.display = 'none';
                iconEl.innerText = 'üö´'; 
                textEl.innerText = "ERROR: EVIDENCE REDACTED";
                textEl.classList.add('blink-text', 'text-red-500');
                bar.style.width = '0%';
                return;
            }

            if (type === 'video') {
                videoUI.style.display = 'flex'; imgUI.style.display = 'none';
                iconEl.innerText = icon; textEl.innerText = "PLAYING: " + title;
                bar.style.width = '0%'; bar.style.transition = 'none';
                setTimeout(() => { bar.style.transition = 'width 5s linear'; bar.style.width = '100%'; }, 100);
            } else {
                videoUI.style.display = 'none'; imgUI.style.display = 'block';
                imgUI.src = src;
                imgUI.onerror = function() { 
                    this.style.display='none'; videoUI.style.display='flex';
                    iconEl.innerText = 'üñºÔ∏è'; textEl.innerText = "IMAGE: " + title; 
                };
            }
        }

        function closeZoom() { document.getElementById('zoom-modal').classList.remove('active'); }

        function cycleZoom(direction) {
            const slideItems = document.querySelectorAll(`#slide-${currentSlideIndex} .interactive-item`);
            if (slideItems.length === 0) return;

            if (direction === 'next') zoomIndex = (zoomIndex + 1) % slideItems.length;
            else zoomIndex = (zoomIndex - 1 + slideItems.length) % slideItems.length;

            // Trigger click on new item to update zoom
            slideItems[zoomIndex].click();
        }

        function triggerConfetti() {
            document.getElementById('winner-ui').style.display = 'flex';
            var end = Date.now() + 3000;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#000', '#facc15'], zIndex: 9999 });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#000', '#facc15'], zIndex: 9999 });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        // --- INPUTS ---
        document.addEventListener('keydown', (e) => {
            const isZoom = document.getElementById('zoom-modal').classList.contains('active');
            
            // Alt Key Logic
            if (e.key === 'Alt') {
                e.preventDefault();
                if (currentSlideIndex === 7) {
                    const banner = document.getElementById('winner-ui');
                    banner.style.display = (banner.style.display === 'flex') ? 'none' : 'flex';
                }
                return;
            }

            switch(e.key) {
                case 'PageDown': case 'ArrowDown': case 'Right':
                    e.preventDefault(); 
                    if(isZoom) cycleZoom('next'); 
                    else goToSlide(currentSlideIndex + 1); 
                    break;
                case 'PageUp': case 'ArrowUp': case 'Left':
                    e.preventDefault(); 
                    if(isZoom) cycleZoom('prev'); 
                    else goToSlide(currentSlideIndex - 1); 
                    break;
                case 'Tab': 
                    e.preventDefault(); 
                    if (isZoom) closeZoom(); else triggerAction(); 
                    break;
                case 'b': case 'B': 
                    const vp = document.getElementById('viewport');
                    if (blackoutState) {
                        location.reload(); 
                    } else {
                        vp.classList.remove('crt-on');
                        vp.classList.add('crt-off');
                        blackoutState = true;
                    }
                    break;
            }
        });
    </script>
</body>
</html>
