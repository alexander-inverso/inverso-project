<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TEFQ: Jealousy Engine v29.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;500;700&family=JetBrains+Mono:wght@400;800&display=swap');

        :root {
            --bg-color: #ffffff;
            --text-color: #000000;
            --accent-color: #facc15;
            --danger-color: #f97316;
            --critical-color: #ef4444;
        }

        /* --- GLOBAL RESET --- */
        * { scrollbar-width: none !important; -ms-overflow-style: none !important; }
        *::-webkit-scrollbar { display: none !important; width: 0 !important; height: 0 !important; }

        body {
            background-color: #000;
            color: var(--text-color);
            font-family: 'Space Grotesk', sans-serif;
            overflow: hidden;
            height: 100vh; width: 100vw;
            margin: 0; padding: 0;
        }

        .font-mono { font-family: 'JetBrains Mono', monospace; }

        /* --- SYSTEM LAYERS (NEW ARCHITECTURE) --- */
        
        /* 1. Blackout Layer (The Quote Screen) */
        #blackout-layer {
            position: fixed; inset: 0; background: black; z-index: 30000;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            opacity: 1; transition: opacity 0.5s; pointer-events: auto;
        }
        #blackout-layer.hidden-layer { opacity: 0; pointer-events: none; }

        /* 2. System Root (The Container that gets turned ON/OFF) */
        #system-root {
            width: 100vw; height: 100vh; position: relative;
            transform-origin: center; will-change: transform, filter;
            opacity: 0; /* Default OFF */
        }

        /* 3. Shake Wrapper (The Container that shakes) */
        #shake-wrapper { width: 100%; height: 100%; position: relative; }

        /* CRT ANIMATIONS */
        .crt-on { animation: turnOn 0.8s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        @keyframes turnOn {
            0% { transform: scale(0.001, 0.001); filter: brightness(3); opacity: 1; }
            40% { transform: scale(1, 0.002); filter: brightness(2); opacity: 1; }
            100% { transform: scale(1, 1); filter: brightness(1); opacity: 1; }
        }

        .crt-off { animation: turnOff 0.6s cubic-bezier(0.23, 1, 0.32, 1) forwards; }
        @keyframes turnOff {
            0% { transform: scale(1, 1); filter: brightness(1); opacity: 1; }
            40% { transform: scale(1, 0.002); filter: brightness(2); opacity: 1; }
            80% { transform: scale(0.001, 0.001); filter: brightness(3); opacity: 1; }
            100% { transform: scale(0, 0); filter: brightness(0); opacity: 0; }
        }

        /* --- SLIDE --- */
        section.slide {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            padding: 4rem 2rem; background: white;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1.000);
            will-change: transform;
        }
        .slide.past { transform: translateY(-100%); z-index: 0; }
        .slide.active { transform: translateY(0); z-index: 10; }
        .slide.future { transform: translateY(100%); z-index: 20; }

        /* --- UI ELEMENTS --- */
        .scanlines {
            position: fixed; inset: 0; pointer-events: none; z-index: 31000; /* Above blackout */
            background: linear-gradient(
                to bottom,
                rgba(255,255,255,0),
                rgba(255,255,255,0) 50%,
                rgba(0,0,0,0.1) 50%,
                rgba(0,0,0,0.1) 
            );
            background-size: 100% 6px;
            animation: scan-drift 8s ease-in-out infinite alternate;
        }
        @keyframes scan-drift { 0% { background-position-y: 0px; } 100% { background-position-y: 100px; } }

        .narrative-container {
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
            width: 80%; max-width: 800px;
            background: black; color: white; padding: 10px 20px;
            font-family: 'JetBrains Mono', monospace; font-size: 0.9rem;
            border-left: 4px solid var(--accent-color);
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            z-index: 20000;
        }
        .narrative-label { color: var(--accent-color); font-weight: bold; text-transform: uppercase; margin-right: 10px; }

        .hud-container {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 95%; max-width: 1400px; height: 40px;
            display: flex; align-items: center; gap: 0;
            z-index: 20000; border: 2px solid black; background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .hud-label { background: black; color: white; height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; }
        .hud-track { flex-grow: 1; height: 100%; background: #e5e5e5; position: relative; overflow: hidden; }
        
        .hud-bar { height: 100%; width: 0%; background: var(--accent-color); position: relative; transition: width 1s linear; }
        .hud-bar.hazard-bg {
            background-image: repeating-linear-gradient(45deg, rgba(0,0,0,0.1), rgba(0,0,0,0.1) 10px, transparent 10px, transparent 20px);
            background-size: 28px 28px; animation: moveStripes 1s linear infinite;
        }
        @keyframes moveStripes { from { background-position: 0 0; } to { background-position: 56px 0; } }
        
        .hud-value { background: black; color: var(--accent-color); height: 100%; display: flex; align-items: center; padding: 0 16px; font-weight: 800; min-width: 160px; justify-content: flex-end; }
        .page-counter { background: var(--accent-color); color: black; height: 100%; display: flex; align-items: center; padding: 0 12px; font-weight: 900; border-left: 2px solid black; }

        /* --- CARDS & LISTS --- */
        .brutalist-card {
            border: 3px solid black; background: white;
            box-shadow: 6px 6px 0px black; transition: transform 0.1s;
            cursor: pointer; overflow: hidden; position: relative;
            display: flex; flex-direction: column;
        }
        .brutalist-card:hover, .brutalist-card.active-focus {
            transform: translate(-3px, -3px); box-shadow: 9px 9px 0px var(--accent-color); border-color: black; z-index: 20;
        }
        .brutalist-card:active, .brutalist-card.action-pressed {
            transform: translate(2px, 2px); box-shadow: 2px 2px 0px var(--accent-color);
        }
        .brutalist-card.is-empty { border-color: #ef4444; opacity: 0.8; }
        .brutalist-card.is-empty .card-icon { background: #fee2e2; color: #ef4444; }
        .card-icon { font-size: 4rem; background: #f3f4f6; flex-grow: 1; display: flex; align-items: center; justify-content: center; border-bottom: 3px solid black; }
        .card-content { padding: 1rem; background: white; }
        
        .bullet-list { font-family: 'JetBrains Mono', monospace; font-size: 0.9rem; color: #333; }
        .bullet-list li { margin-bottom: 0.5rem; display: flex; align-items: flex-start; }
        .bullet-list li::before { content: ">>"; color: var(--accent-color); background: black; margin-right: 8px; padding: 0 4px; font-weight: bold; font-size: 0.8rem; }

        /* Chart */
        .roi-panel { background: #111; border: 2px solid var(--accent-color); color: var(--accent-color); padding: 0.5rem 1rem; font-family: 'JetBrains Mono', monospace; display: flex; flex-direction: column; justify-content: center; height: 80px; }
        .roi-panel.victim { border-color: #444; color: #666; }
        .roi-value { font-size: 2rem; font-weight: 800; line-height: 1; }
        .roi-label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        .victim-btn { border: 3px solid black; background: white; padding: 1rem; text-align: left; font-weight: bold; cursor: pointer; transition: all 0.1s; margin-bottom: 0.5rem; position: relative; }
        .victim-btn.active { background: black; color: var(--accent-color); border-color: black; transform: translate(4px, 0); box-shadow: -4px 0 0 var(--accent-color); }
        .victim-btn.active-press { transform: scale(0.98); background: var(--accent-color); color: black; }

        /* --- ZOOM OVERLAY --- */
        .zoom-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 15000;
            display: none; flex-direction: row; align-items: center; justify-content: center; gap: 2rem; padding: 2rem;
        }
        .zoom-overlay.active { display: flex; }
        
        /* Zoom Cover / Placeholder Logic */
        .zoom-cover {
            position: absolute; inset: 0; background: rgba(0,0,0,0.4); 
            display: flex; align-items: center; justify-content: center;
            z-index: 50; cursor: pointer; transition: opacity 0.2s;
        }
        .zoom-cover:hover { background: rgba(0,0,0,0.2); }
        .zoom-cover.hidden { opacity: 0; pointer-events: none; }
        .zoom-cover-emoji { font-size: 8rem; filter: drop-shadow(0 0 10px black); transition: transform 0.2s; }
        .zoom-cover:hover .zoom-cover-emoji { transform: scale(1.1); }

        #zoom-thumbs { display: flex; flex-direction: column; gap: 1rem; max-height: 80vh; overflow-y: auto; width: 80px; flex-shrink: 0; }
        .zoom-thumb { width: 80px; height: 80px; border: 2px solid #333; background: #111; display: flex; align-items: center; justify-content: center; font-size: 2rem; color: #666; cursor: pointer; transition: all 0.2s; }
        .zoom-thumb.active { border-color: var(--accent-color); color: white; background: #222; transform: scale(1.05); box-shadow: 4px 4px 0px var(--accent-color); }

        .zoom-content {
            flex-grow: 1;
            max-width: 1200px;
            max-height: 80vh;
            background: #111;
            border: 4px solid var(--accent-color);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 100px rgba(250, 204, 21, 0.1);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
        }

        .zoom-content video,
        .zoom-content img {
            max-width: 90%;
            max-height: 90%;
            width: auto;
            height: auto;
            display: block;
            object-fit: contain;
        }
        
        /* Winner UI */
        .winner-banner { display: none; position: fixed; inset: 0; background: rgba(0, 0, 0, 0.85); z-index: 5000; align-items: center; justify-content: center; }
        .winner-frame { font-size: 10vw; font-weight: 900; border: 20px solid black; padding: 20px 60px; background: var(--accent-color); transform: rotate(-3deg); box-shadow: 10px 10px 0px black; width: fit-content; }
        
        /* VFX */
        .screen-shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both infinite; }
        @keyframes shake { 0% { transform: translate(0, 0) rotate(0deg); } 20% { transform: translate(3px, 3px) rotate(1deg); } 40% { transform: translate(3px, -3px) rotate(1deg); } 60% { transform: translate(2px, 2px) rotate(0deg); } 80% { transform: translate(2px, -2px) rotate(-1deg); } 100% { transform: translate(0, 0) rotate(0deg); } }
        .hero-badge { border: 4px solid black; background: white; padding: 8px 16px; font-weight: 800; font-family: 'JetBrains Mono', monospace; transform: rotate(-3deg); box-shadow: 4px 4px 0px rgba(0,0,0,0.2); margin-bottom: 2rem; }
        
        /* Smoke */
        .smoke-particle { position: fixed; background: radial-gradient(circle, rgba(50,50,50,0.9) 0%, rgba(0,0,0,0) 70%); border-radius: 50%; pointer-events: none; z-index: 16000; animation: smokeRise 2s forwards; filter: blur(4px); }
        @keyframes smokeRise { 0% { transform: scale(0.5) translate(0, 0); opacity: 0.8; } 100% { transform: scale(3) translate(var(--drift), -100px); opacity: 0; } }

        /* Clock */
        .clock-face { width: 300px; height: 300px; border: 6px solid #000; border-radius: 50%; position: relative; background: white; box-shadow: 10px 10px 0px rgba(0,0,0,0.2); transition: transform 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55); }
        .clock-face.broken { transform: translateY(150px) rotate(25deg); }
        
        .crack-overlay { position: absolute; inset: 0; pointer-events: none; opacity: 0; display: flex; align-items: center; justify-content: center; z-index: 100; font-family: monospace; font-weight: bold; font-size: 80px; color: black; line-height: 0.8; }
        .clock-face.broken .crack-overlay { opacity: 1; }
        
        .hand { position: absolute; bottom: 50%; left: 50%; transform-origin: bottom center; background: black; transition: transform 0.1s linear; }
        #hand-thin { width: 4px; height: 45%; margin-left: -2px; background: #ef4444; } /* SECONDS */
        #hand-large { width: 8px; height: 40%; margin-left: -4px; } /* MINUTES */
        
        .pov-sticker { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-10deg) scale(0); background: #facc15; border: 4px solid black; padding: 20px; font-family: 'JetBrains Mono', monospace; font-weight: 900; font-size: 2rem; text-align: center; box-shadow: 10px 10px 0px rgba(0,0,0,0.5); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 60; }
        .pov-sticker.visible { transform: translate(-50%, -50%) rotate(-10deg) scale(1); }
        
        /* DYNAMIC TAGS */
        .multi-indicator { position: absolute; top: 10px; right: 10px; background: black; color: white; font-family: 'JetBrains Mono'; font-size: 0.7rem; padding: 2px 6px; border-radius: 4px; z-index: 5; }
        
        .list-item-active { background: black !important; color: white !important; border-color: var(--accent-color) !important; transform: scale(0.98); }
        .defeat-btn { transition: transform 0.1s; }
        .defeat-btn:active, .defeat-btn.active-press { transform: scale(0.95) !important; background-color: #facc15 !important; }
    </style>
</head>
<body>

    <script>
        // --- MANIFEST CONFIG ---
        const MEDIA_ROOT = "./TEFQ Media";
        const MEDIA_MANIFEST = {
            "ignition": {
                folder: "01_Ignition",
                title: "IGNITION PROTOCOL",
                files: [
                    {
                        name: "alcohol_fire.mp4",
                        title: "ALCOHOL FIRE PRACTICE",
                        bullets: [
                            "Cool flames practice: goes wrong",
                            "Fire alarm? Never heard of her",
                            "Could've made s'mores tbh"
                        ]
                    },
                    {
                        name: "leidenfrost.mp4",
                        title: "LEIDENFROST EFFECT",
                        bullets: [
                            "Dropped water on hot plate. Oops",
                            "Accidentally discovered physics",
                            "Even our mistakes are smart"
                        ]
                    }
                ]
            },
            "halloween": {
                folder: "02_Halloween",
                title: "HALLOWEEN CHAOS",
                files: [
                    {
                        name: "foam_bomb.mp4",
                        title: "PUMPKIN FOAM BOMB",
                        bullets: [
                            "Pumpkin goes nuclear",
                            "Eyes ‚Üí mouth ‚Üí total destruction",
                            "Exothermic violence"
                        ]
                    },
                    {
                        name: "class_halloween.jpg",
                        title: "FULL CLASS PARTICIPATION",
                        bullets: [
                            "Full squad. Maximum chaos",
                            "We showed up. We delivered"
                        ]
                    },
                    {
                        name: "gummies.jpg",
                        title: "LAB GUMMIES",
                        bullets: [
                            "Teacher bribes us with candy",
                            "Usually works the other way around",
                            "TEFQ is different"
                        ]
                    }
                ]
            },
            "christmas": {
                folder: "03_Christmas",
                title: "CHRISTMAS PROTOCOL",
                files: [
                    {
                        name: "tree.jpg",
                        title: "CHEMICAL CHRISTMAS TREE",
                        bullets: [
                            "Chemist-tree. Get it?",
                            "Test tubes filled with non-TEFQ tears",
                            "Festive. Dangerous. Ours"
                        ]
                    },
                    {
                        name: "valentin_mixing.mp4",
                        title: "VALENT√çN MIXING BATTER",
                        bullets: [
                            "Valent√≠n stirs. We supervise",
                            "Monkey does the hard work"
                        ]
                    },
                    {
                        name: "class_christmas.jpg",
                        title: "POST-BAKE VICTORY",
                        bullets: [
                            "Post-bake victory photo",
                            "We ate what we cooked"
                        ]
                    },
                    {
                        name: "alex_cake.jpg",
                        title: "PERFECT MUG CAKE",
                        bullets: [
                            "Perfect rise. Perfect ratios",
                            "This is what winning looks like"
                        ]
                    },
                    {
                        name: "overflow_cake.jpg",
                        title: "NUCLEAR MUSHROOM",
                        bullets: [
                            "Nuclear mushroom cake",
                            "Too much CO‚ÇÇ. Zero regrets",
                            "Failure never tasted better"
                        ]
                    },
                    {
                        name: "valentin_ingredients.jpg",
                        title: "INGREDIENT STAGING",
                        bullets: [
                            "Mise en place but chemistry",
                            "Pre-synthesis ritual"
                        ]
                    },
                    {
                        name: "valentin_sipping.jpg",
                        title: "QUALITY CONTROL",
                        bullets: [
                            "Quality control",
                            "Valent√≠n approves"
                        ]
                    }
                ]
            },
            "naoh": {
                folder: "04_NaOH",
                title: "LIQUID DANGER",
                files: [
                    {
                        name: "alex_pancho_naoh.jpg",
                        title: "1M NaOH HANDLING",
                        bullets: [
                            "Holding liquid that melts skin",
                            "pH 14. Zero fear",
                            "Casually dangerous"
                        ]
                    },
                    {
                        name: "valentin_hugging.jpg",
                        title: "VALENT√çN + NaOH",
                        bullets: [
                            "Same size as the bottle",
                            "Friends with danger"
                        ]
                    },
                    {
                        name: "valentin_beaker.jpg",
                        title: "BEAKER IMMERSION",
                        bullets: [
                            "Inside the beaker. Normal Tuesday"
                        ]
                    },
                    {
                        name: "valentin_dropper.jpg",
                        title: "DROPPER TECHNIQUE",
                        bullets: [
                            "Two hands. Proper technique",
                            "Even the monkey knows protocol"
                        ]
                    }
                ]
            },
            "chair": {
                folder: "05_Chair",
                title: "INFRASTRUCTURE",
                files: [
                    {
                        name: "exploding_chair.mp4",
                        title: "CHAIR STRUCTURAL FAILURE",
                        bullets: [
                            "Levitates. Explodes. Cinema",
                            "We earned cushioned seats",
                            "Knowledge density broke it"
                        ]
                    }
                ]
            }
        };
    </script>

    <div class="scanlines"></div>
    <div id="toast" class="instruction-toast">ACTION TRIGGERED</div>
    <div id="winner-ui" class="winner-banner"><div class="winner-frame">TEFQ WINS</div></div>

    <div id="blackout-layer">
        <div class="text-white font-black text-6xl mb-4">TEFQ WINS</div>
        <div class="text-white font-black text-4xl animate-pulse">[ PRESS B TO BEGIN ]</div>
    </div>

    <div id="system-root">
        
        <div id="zoom-modal" class="zoom-overlay">
            <div id="zoom-thumbs"></div>

            <div style="position: relative; flex-grow: 1; max-width: 1200px; max-height: 80vh;">
                <!-- Top title bar -->
                <div id="zoom-text" class="absolute top-4 left-4 font-mono text-white text-sm bg-black px-2 z-50 border border-yellow-400">LOADING...</div>

                <!-- Main content frame - ONLY contains media -->
                <div class="zoom-content" id="zoom-frame"></div>
            </div>

            <!-- File-specific metadata overlay - positioned dynamically -->
            <div class="fixed bg-black bg-opacity-95 border-2 border-yellow-400 p-4 font-mono text-white z-50" id="zoom-metadata" style="display: none; max-width: 400px; transition: all 0.3s ease; pointer-events: none;">
                <div class="text-yellow-400 font-bold text-sm mb-2" id="zoom-file-title">FILE TITLE</div>
                <ul class="list-none space-y-1 text-xs" id="zoom-file-bullets">
                    <li class="flex items-start"><span class="text-yellow-400 mr-2">>></span><span>Bullet 1</span></li>
                </ul>
            </div>

            <div class="fixed bottom-10 text-white font-mono text-sm bg-black px-4 py-2 border border-white">
                [‚Üë/‚Üì] NEXT FILE &nbsp;|&nbsp; [TAB] CLOSE
            </div>
        </div>

        <div class="narrative-container" id="narrative-ui">
            <div><span class="narrative-label">THREAD:</span> <span id="narrative-thread">LOADING...</span></div>
            <div class="text-gray-400" id="narrative-text">...</div>
        </div>

        <div class="hud-container">
            <div class="hud-label">AUDIENCE STATUS</div>
            <div class="hud-track">
                <div id="jealousy-bar" class="hud-bar hazard-bg"></div>
            </div>
            <div id="jealousy-val" class="hud-value">0% JEALOUS</div>
            <div class="page-counter" id="page-counter">01 / 07</div>
        </div>

        <div id="shake-wrapper">
            <div id="viewport">
                <section id="slide-0" class="slide active" data-progress="0" data-thread="The Hook" data-narrative="We're about to make you very, very jealous.">
                    <div class="hero-badge">EXPERIMENTAL SUPREMACY v31</div>
                    <h1 class="text-9xl font-black mb-2 tracking-tighter">TEFQ</h1>
                    <h2 class="text-4xl font-thin text-gray-500">JUST TO MAKE YOU <span class="bg-yellow-400 text-black px-2 font-bold">JEALOUS</span>.</h2>
                    <div class="mt-16 font-mono text-sm text-gray-400 animate-bounce">[PRESS DOWN TO BEGIN]</div>
                </section>

                <section id="slide-1" class="slide future" data-progress="8" data-thread="Disclaimer" data-narrative="There are others. We acknowledge them. We'll ignore them.">
                    <div class="w-full max-w-4xl">
                        <h3 class="text-7xl font-black mb-8 text-center border-b-8 border-black pb-6">DISCLAIMER</h3>
                        <div class="p-10 border-4 border-black bg-gray-50 shadow-[16px_16px_0px_#000]">
                            <p class="text-2xl font-bold mb-6 font-mono text-center">
                                YES, THERE ARE OTHER PEOPLE WHO <span class="bg-yellow-400 px-2 py-1 font-black">TEFQ</span> WITH US.
                            </p>
                            <p class="text-xl font-mono text-center leading-relaxed">
                                We acknowledge their existence.<br>
                                <span class="text-gray-400">But for the purpose of this presentation,</span><br>
                                <span class="font-bold text-2xl">WE'LL IGNORE THEM.</span>
                            </p>
                        </div>
                        <div class="mt-6 text-center font-mono text-sm text-gray-400">
                            (Yes, we just used TEFQ as a verb. Deal with it.)
                        </div>
                    </div>
                </section>

                <section id="slide-2" class="slide future" data-progress="15" data-thread="The Roadmap" data-narrative="Evidence categorized into 6 proof modules.">
                    <div class="w-full max-w-5xl">
                        <h3 class="text-6xl font-black mb-12 border-b-4 border-black pb-4">EVIDENCE LOCKER</h3>
                        <div class="grid grid-cols-2 gap-8 font-mono text-sm">
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>01. IGNITION</strong><br>Real risk, real data collection.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>02. HALLOWEEN</strong><br>Exothermic chaos protocol.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>03. ACADEMIC ROI</strong><br>20x efficiency proof.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>04. CHRISTMAS</strong><br>Edible stoichiometry.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>05. LIQUID DANGER</strong><br>1M NaOH capability.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>06. THE CHAIR GAP</strong><br>Infrastructure superiority.</div>
                            <div class="p-4 border-l-8 border-black bg-gray-50"><strong>07. VERDICT</strong><br>Confetti protocol.</div>
                        </div>
                    </div>
                </section>

                <section id="slide-3" class="slide future" data-progress="30" data-thread="Module 01" data-narrative="Real combustion. Real data. No textbooks.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-5 flex flex-col justify-center h-full">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">APPLIED CHAOS</h3>
                            <ul class="bullet-list space-y-4">
                                <li><strong>Real Combustion:</strong> Not textbook diagrams.</li>
                                <li><strong>Risk Mitigation:</strong> We didn't panic. We collected data.</li>
                                <li><strong>Recovery Protocol:</strong> Leidenfrost effect observed.</li>
                                <li><strong>In PE, a spill is clumsy.</strong> Here, it's physics.</li>
                            </ul>
                        </div>
                        <div class="col-span-7 flex items-center justify-center">
                            <div class="brutalist-card interactive-item" data-media-id="ignition" style="width: 100%; max-width: 500px; height: 400px;">
                                <div class="card-icon text-8xl">üî•‚öóÔ∏è</div>
                                <div class="card-content font-bold text-center">Ignition Protocol<br><span class="text-yellow-600">2 FILES</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-4" class="slide future" data-progress="45" data-thread="Module 02" data-narrative="While others carved pumpkins, we pressurized one.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-5 flex flex-col justify-center h-full">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">EXOTHERMIC ABOMINATIONS</h3>
                            <ul class="bullet-list space-y-4">
                                <li><strong>While others carved pumpkins,</strong> we pressurized one.</li>
                                <li><strong>Foam Protocol:</strong> Eyes first, then mouth, total coverage.</li>
                                <li><strong>Teacher Olga brought gummies.</strong> We ate them in the lab.</li>
                                <li><strong>Exothermic expansion</strong> in organic matter.</li>
                            </ul>
                        </div>
                        <div class="col-span-7 flex items-center justify-center">
                            <div class="brutalist-card interactive-item" data-media-id="halloween" style="width: 100%; max-width: 500px; height: 400px;">
                                <div class="card-icon text-8xl">üéÉü´ß</div>
                                <div class="card-content font-bold text-center">Halloween Chaos<br><span class="text-orange-600">3 FILES</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-5" class="slide future" data-progress="52" data-thread="Academic Proof" data-narrative="Numbers don't lie. 20x efficiency advantage.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-4">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">ACADEMIC ROI</h3>
                            <ul class="bullet-list space-y-4 mb-8">
                                <li><strong>Empirical Efficiency:</strong> Real reactions, real results.</li>
                                <li><strong>Hands-On Mastery:</strong> Mixing acid, not theory.</li>
                                <li><strong>Grade Dominance:</strong> 20x efficiency ratio.</li>
                            </ul>
                            <div class="interactive-group flex flex-col gap-2">
                                <div class="victim-btn active interactive-item" id="btn-it">IT STUDENT</div>
                                <div class="victim-btn interactive-item" id="btn-pe">PE STUDENT</div>
                                <div class="victim-btn interactive-item" id="btn-psych">PSYCH STUDENT</div>
                                <div class="victim-btn interactive-item" id="btn-french">FRENCH STUDENT</div>
                            </div>
                        </div>
                        <div class="col-span-8 flex flex-col gap-4">
                            <div class="grid grid-cols-2 gap-4">
                                <div class="roi-panel"><div class="roi-label">TEFQ EFFICIENCY</div><div class="roi-value" id="tefq-roi">20.0x</div></div>
                                <div class="roi-panel victim" id="victim-panel"><div class="roi-label" id="victim-label">IT EFFICIENCY</div><div class="roi-value text-white" id="victim-roi">0.7x</div></div>
                            </div>
                            <div class="border-4 border-black bg-white p-4 shadow-[12px_12px_0px_#e5e7eb] h-[400px]">
                                <canvas id="dataChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-6" class="slide future" data-progress="68" data-thread="Module 03" data-narrative="We don't cook with love. We cook with stoichiometry.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-5 flex flex-col justify-center h-full">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">EDIBLE ENGINEERING</h3>
                            <ul class="bullet-list space-y-4">
                                <li><strong>Christmas tree watered</strong> with the tears of non-TEFQ students.</li>
                                <li><strong>Valent√≠n:</strong> Lab mascot and baking assistant.</li>
                                <li><strong>Calculation errors</strong> result in nuclear mushrooms.</li>
                                <li><strong>Expectation vs Reality:</strong> Stoichiometric precision.</li>
                            </ul>
                        </div>
                        <div class="col-span-7 flex items-center justify-center">
                            <div class="brutalist-card interactive-item" data-media-id="christmas" style="width: 100%; max-width: 500px; height: 400px;">
                                <div class="card-icon text-8xl">üéÑüßÅ</div>
                                <div class="card-content font-bold text-center">Christmas Protocol<br><span class="text-green-600">7 FILES</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-7" class="slide future" data-progress="80" data-thread="Module 04" data-narrative="We handle lethal substances. Casually.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-5 flex flex-col justify-center h-full">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">1M NaOH: LIQUID DANGER</h3>
                            <ul class="bullet-list space-y-4">
                                <li><strong>Dissolves organic matter.</strong> Cleans fingerprints.</li>
                                <li><strong>Valent√≠n befriends the bottle</strong> (they're the same size).</li>
                                <li><strong>Safety through confidence.</strong> Precision handling.</li>
                                <li><strong>Lab mascot training:</strong> Equipment familiarity protocol.</li>
                            </ul>
                        </div>
                        <div class="col-span-7 flex items-center justify-center">
                            <div class="brutalist-card interactive-item" data-media-id="naoh" style="width: 100%; max-width: 500px; height: 400px;">
                                <div class="card-icon text-8xl">‚öóÔ∏è‚ò†Ô∏è</div>
                                <div class="card-content font-bold text-center">NaOH Protocol<br><span class="text-red-600">4 FILES</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-8" class="slide future" data-progress="90" data-thread="Module 05" data-narrative="Some chairs hold students. Ours hold knowledge density.">
                    <div class="w-full max-w-7xl grid grid-cols-12 gap-8 h-full items-center">
                        <div class="col-span-5 flex flex-col justify-center h-full">
                            <h3 class="text-5xl font-black mb-6 border-l-8 border-yellow-400 pl-4">SUPERIOR INFRASTRUCTURE</h3>
                            <ul class="bullet-list space-y-4">
                                <li><strong>The Chair Gap:</strong> A study in comfort economics.</li>
                                <li><strong>Earned through hard work,</strong> not assigned by schedule.</li>
                                <li><strong>Some chairs hold students.</strong> Ours hold knowledge density.</li>
                                <li><strong>Structural failure:</strong> Material limits exceeded.</li>
                            </ul>
                        </div>
                        <div class="col-span-7 flex items-center justify-center">
                            <div class="brutalist-card interactive-item" data-media-id="chair" style="width: 100%; max-width: 500px; height: 400px;">
                                <div class="card-icon text-8xl">üí∫üí•</div>
                                <div class="card-content font-bold text-center">Chair Gap Analysis<br><span class="text-purple-600">1 FILE</span></div>
                            </div>
                        </div>
                    </div>
                </section>

                <section id="slide-9" class="slide future" data-progress="100" data-thread="The Verdict" data-narrative="While others theorized, we dominated. Results are undeniable.">
                    <div class="w-full max-w-5xl">
                        <h1 class="text-7xl font-black mb-4 text-center" id="verdict-header">
                            <span class="text-yellow-400">TEFQ:</span> SUPREMACY PROVEN
                        </h1>

                        <div class="grid grid-cols-3 gap-4 mb-6 font-mono text-sm">
                            <div class="p-3 border-2 border-yellow-400 bg-black text-yellow-400 text-center">
                                <div class="text-3xl font-black">17</div>
                                <div class="text-xs opacity-80">EVIDENCE FILES</div>
                            </div>
                            <div class="p-3 border-2 border-yellow-400 bg-black text-yellow-400 text-center">
                                <div class="text-3xl font-black">20x</div>
                                <div class="text-xs opacity-80">EFFICIENCY RATIO</div>
                            </div>
                            <div class="p-3 border-2 border-yellow-400 bg-black text-yellow-400 text-center">
                                <div class="text-3xl font-black">100%</div>
                                <div class="text-xs opacity-80">PROOF DELIVERED</div>
                            </div>
                        </div>

                        <div class="p-6 border-4 border-yellow-400 bg-black text-white shadow-[12px_12px_0px_#facc15] text-center">
                            <p class="text-xl font-bold text-yellow-400 mb-3">THE VERDICT:</p>
                            <p class="text-base mb-4 font-mono leading-relaxed">
                                While IT students memorize syntax,<br>
                                while PE students run laps,<br>
                                while French students conjugate verbs,<br>
                                <span class="text-yellow-400 font-black text-xl">WE CREATE, EXPERIMENT, AND DOMINATE.</span>
                            </p>

                            <div class="defeat-btn bg-yellow-400 text-black font-black text-4xl p-5 border-4 border-white cursor-pointer hover:scale-105 transition interactive-item active-focus" id="defeat-btn" onclick="triggerVerdict()">
                                [ ACKNOWLEDGE SUPREMACY ]
                            </div>

                            <div id="valentin-victory" style="display: none; margin-top: 1.5rem;">
                                <img src="./TEFQ Media/06_Valentin/dabbing.jpg" style="max-width: 280px; max-height: 280px; object-fit: contain; border: 4px solid var(--accent-color); margin: 0 auto; display: block;" alt="Valent√≠n Victory">
                                <p class="text-yellow-400 font-black text-lg mt-3">EVEN VALENT√çN KNOWS.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const studentProfiles = {
            it: { name: 'IT STUDENT', label: 'IT EFFICIENCY', suffering: 9, dignity: 2, grade: 5 },
            pe: { name: 'PE STUDENT', label: 'PE EFFICIENCY', suffering: 10, dignity: 4, grade: 8 },
            psych: { name: 'PSYCH STUDENT', label: 'PSYCH EFFICIENCY', suffering: 7, dignity: 5, grade: 6 },
            french: { name: 'FRENCH STUDENT', label: 'FRENCH EFFICIENCY', suffering: 8, dignity: 0, grade: 4 }
        };
        const victimKeys = ['it', 'pe', 'psych', 'french'];
        const tefqStats = { suffering: 1, dignity: 10, grade: 10 };

        // --- STATE ---
        let systemOn = false; // Starts OFF
        let currentSlideIndex = 0;
        const totalSlides = 10; // Updated to 10 slides
        let interactionIndex = 0;
        let chartInstance = null;
        let currentVictimIndex = 0;

        let currentGallery = [];
        let currentMediaIndex = 0;
        let currentMediaElement = null; // Track current playing media 
        
        // --- INIT ---
        window.onload = function() {
            initMediaSystem();

            // Start Monitor
            setInterval(monitorJealousyColor, 100);
            updateNarrative(0);
            updatePageCounter(0);
        };

        function initMediaSystem() {
            const cards = document.querySelectorAll('[data-media-id]');
            cards.forEach(card => {
                const key = card.getAttribute('data-media-id');
                const config = MEDIA_MANIFEST[key];
                if (!config) return;

                const fileCount = config.files.length;

                if (fileCount === 0) {
                    card.classList.add('is-empty');
                    card.querySelector('.card-content span').innerHTML = "EVIDENCE MISSING";
                    card.querySelector('.card-content span').className = "text-red-500 font-bold blink-text";
                    card.onclick = () => triggerZoom([], config);
                } else {
                    // Pass the entire config object with file metadata
                    card.onclick = () => triggerZoom(config.files, config);
                    if (fileCount > 1) {
                        const badge = document.createElement('div');
                        badge.className = 'multi-indicator';
                        badge.innerText = `${fileCount} FILES`;
                        card.appendChild(badge);
                    }
                }
            });
        }

        // --- NAVIGATION ---
        function goToSlide(index) {
            if (index < 0 || index >= totalSlides) return;
            if (document.getElementById('zoom-modal').classList.contains('active')) return;

            const slides = document.querySelectorAll('section.slide');
            slides.forEach((slide, i) => {
                slide.classList.remove('active', 'past', 'future');
                if (i < index) slide.classList.add('past');
                else if (i === index) slide.classList.add('active');
                else slide.classList.add('future');
            });

            currentSlideIndex = index;
            interactionIndex = 0;
            updateInteractionFocus();
            updateNarrative(index);
            updatePageCounter(index);

            const activeSlide = document.getElementById(`slide-${index}`);
            const progress = parseFloat(activeSlide.getAttribute('data-progress'));
            updateJealousy(progress);

            // Initialize chart on slide 5
            if (index === 5) setTimeout(() => initChart(), 500);
        }

        function updateNarrative(index) {
            const slide = document.getElementById(`slide-${index}`);
            document.getElementById('narrative-thread').innerText = slide.getAttribute('data-thread');
            document.getElementById('narrative-text').innerText = slide.getAttribute('data-narrative');
        }

        function updatePageCounter(index) {
            document.getElementById('page-counter').innerText = `0${index} / 0${totalSlides-1}`;
        }

        // --- JEALOUSY MONITOR (ANIMATED) ---
        let currentJealousyVal = 0;
        function updateJealousy(target) {
            const bar = document.getElementById('jealousy-bar');
            const num = document.getElementById('jealousy-val');
            
            // Bar Animation (CSS)
            bar.style.width = target + '%';
            
            // Number Animation (JS Tween)
            const start = currentJealousyVal;
            const end = target;
            const duration = 1000;
            const startTime = performance.now();

            function update(currentTime) {
                const elapsed = currentTime - startTime;
                const progress = Math.min(elapsed / duration, 1);
                // Ease out cubic
                const ease = 1 - Math.pow(1 - progress, 3);
                
                currentJealousyVal = Math.floor(start + (end - start) * ease);
                num.innerText = currentJealousyVal + '% JEALOUS';

                if (progress < 1) requestAnimationFrame(update);
            }
            requestAnimationFrame(update);
        }

        function monitorJealousyColor() {
            const bar = document.getElementById('jealousy-bar');
            const num = document.getElementById('jealousy-val');
            const wrapper = document.getElementById('shake-wrapper'); // Only shake the wrapper
            
            const parentWidth = bar.parentElement.clientWidth;
            const width = bar.clientWidth;
            const percent = (width / parentWidth) * 100;

            let color = 'var(--accent-color)';
            let shake = false;

            if (percent > 60) color = 'var(--danger-color)';
            if (percent >= 95) {
                color = 'var(--critical-color)';
                shake = true;
            }

            bar.style.backgroundColor = color;
            if (percent >= 99) num.style.color = 'var(--critical-color)';
            else num.style.color = 'var(--accent-color)';

            if (shake && systemOn) wrapper.classList.add('screen-shake');
            else wrapper.classList.remove('screen-shake');
        }

        // --- VERDICT LOGIC ---
        function triggerVerdict() {
            // Trigger confetti
            triggerConfetti();

            // Change header
            document.getElementById('verdict-header').textContent = 'TEFQ SUPREMACY CONFIRMED';

            // Show Valent√≠n victory image
            document.getElementById('valentin-victory').style.display = 'block';
        }

        // --- CHART LOGIC ---
        function initChart() {
            const ctx = document.getElementById('dataChart');
            if (!ctx || chartInstance) return;
            Chart.defaults.font.family = 'JetBrains Mono';
            Chart.defaults.font.size = 14;
            Chart.defaults.color = '#000';
            chartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['SUFFERING', 'DIGNITY', 'GRADE'],
                    datasets: [
                        { label: 'TEFQ', data: [tefqStats.suffering, tefqStats.dignity, tefqStats.grade], backgroundColor: '#facc15', borderWidth: 3, borderColor: 'black' },
                        { label: studentProfiles['it'].name, data: [studentProfiles['it'].suffering, studentProfiles['it'].dignity, studentProfiles['it'].grade], backgroundColor: '#000000', borderWidth: 0 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'top', labels: { font: { weight: 'bold' } } } },
                    scales: { y: { beginAtZero: true, max: 10, grid: { color: '#f3f4f6' } }, x: { grid: { display: false }, ticks: { font: { weight: 'bold' } } } },
                    animation: { duration: 1000, easing: 'easeOutElastic' }
                }
            });
            document.getElementById('tefq-roi').innerText = calculateROI(tefqStats) + "x";
            document.getElementById('victim-roi').innerText = calculateROI(studentProfiles['it']) + "x";
        }

        function calculateROI(stats) {
            return ((stats.grade + stats.dignity) / stats.suffering).toFixed(1);
        }

        function updateVictimChart(victimId) {
            document.querySelectorAll('.victim-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`btn-${victimId}`).classList.add('active');
            const btn = document.getElementById(`btn-${victimId}`);
            btn.classList.add('active-press');
            setTimeout(() => btn.classList.remove('active-press'), 100);

            const victim = studentProfiles[victimId];
            if (!chartInstance) initChart();
            else {
                chartInstance.data.datasets[1].label = victim.name;
                chartInstance.data.datasets[1].data = [victim.suffering, victim.dignity, victim.grade];
                chartInstance.update();
            }
            const victimROI = calculateROI(victim);
            document.getElementById('victim-label').innerText = victim.label;
            document.getElementById('victim-roi').innerText = victimROI + "x";
            document.getElementById('victim-panel').classList.add('border-red-500');
            setTimeout(() => document.getElementById('victim-panel').classList.remove('border-red-500'), 300);
        }

        // --- MEDIA PLAYER LOGIC ---
        let currentConfig = null; // Store config for metadata access

        function triggerZoom(mediaArray, config) {
            currentGallery = mediaArray;
            currentConfig = config;
            currentMediaIndex = 0;
            updateZoomDisplay();
            document.getElementById('zoom-modal').classList.add('active');
        }

        function updateZoomDisplay() {
            const zoomFrame = document.getElementById('zoom-frame');
            const thumbsContainer = document.getElementById('zoom-thumbs');
            const zoomText = document.getElementById('zoom-text');
            const zoomMetadata = document.getElementById('zoom-metadata');
            const zoomFileTitle = document.getElementById('zoom-file-title');
            const zoomFileBullets = document.getElementById('zoom-file-bullets');

            console.log('updateZoomDisplay called', {currentMediaIndex, galleryLength: currentGallery.length});

            // ERROR STATE
            if (!currentConfig || currentGallery.length === 0) {
                console.error('No config or empty gallery');
                zoomFrame.innerHTML = '<div style="color: #ff0000; padding: 20px; font-family: monospace; border: 2px solid #ff0000; text-align: center;"><div style="font-weight: bold; margin-bottom: 10px;">ERROR: NO MEDIA FILES</div><div style="font-size: 12px;">Gallery is empty or not loaded</div></div>';
                zoomMetadata.style.display = 'none';
                zoomText.textContent = 'ERROR';
                thumbsContainer.innerHTML = '';
                currentMediaElement = null;
                return;
            }

            // NORMAL STATE
            const currentFileObj = currentGallery[currentMediaIndex];
            const fileName = currentFileObj.name;
            const filePath = `${MEDIA_ROOT}/${currentConfig.folder}/${fileName}`;

            console.log('Loading file:', filePath);

            // Clear current content (only media, UI stays intact)
            zoomFrame.innerHTML = '';

            // Stop any current media
            if (currentMediaElement && currentMediaElement.pause) {
                currentMediaElement.pause();
            }
            currentMediaElement = null;

            // Update thumbnails
            thumbsContainer.innerHTML = '';
            currentGallery.forEach((file, idx) => {
                const thumb = document.createElement('div');
                thumb.className = 'zoom-thumb';
                thumb.innerText = idx + 1;
                if (idx === currentMediaIndex) thumb.classList.add('active');
                thumb.onclick = () => {
                    currentMediaIndex = idx;
                    updateZoomDisplay();
                };
                thumbsContainer.appendChild(thumb);
            });

            // Update top text
            zoomText.textContent = currentFileObj.title;

            // Update metadata overlay
            zoomFileTitle.textContent = currentFileObj.title;
            zoomFileBullets.innerHTML = '';
            currentFileObj.bullets.forEach(bullet => {
                const li = document.createElement('li');
                li.className = 'flex items-start';
                li.innerHTML = `<span class="text-yellow-400 mr-2">>></span><span>${bullet}</span>`;
                zoomFileBullets.appendChild(li);
            });

            // Handle media type
            if (fileName.endsWith('.mp4')) {
                // Create actual video element
                const video = document.createElement('video');
                video.src = filePath;
                video.muted = true;
                video.loop = true;
                video.controls = true;
                video.autoplay = true;
                video.style.maxWidth = '90%';
                video.style.maxHeight = '90%';
                video.style.objectFit = 'contain';
                video.style.display = 'block';

                video.onerror = (e) => {
                    console.error('Video load error:', filePath, e);
                    zoomFrame.innerHTML = `<div style="color: #ff0000; padding: 20px; font-family: monospace; border: 2px solid #ff0000; text-align: center;">
                        <div style="font-weight: bold; margin-bottom: 10px;">‚ö† VIDEO LOAD ERROR</div>
                        <div style="font-size: 12px; margin-bottom: 5px;">File: ${fileName}</div>
                        <div style="font-size: 12px;">Path: ${filePath}</div>
                        <div style="font-size: 11px; margin-top: 10px; opacity: 0.7;">Check browser console for details</div>
                    </div>`;
                    zoomMetadata.style.display = 'none';
                };

                video.onloadedmetadata = () => {
                    console.log('Video loaded:', fileName, 'Size:', video.videoWidth, 'x', video.videoHeight);
                    const aspectRatio = video.videoWidth / video.videoHeight;
                    const isVertical = aspectRatio < 1;

                    // Position metadata based on aspect ratio
                    if (isVertical) {
                        zoomMetadata.style.right = '20px';
                        zoomMetadata.style.top = '50%';
                        zoomMetadata.style.transform = 'translateY(-50%)';
                        zoomMetadata.style.bottom = 'auto';
                        zoomMetadata.style.left = 'auto';
                    } else {
                        zoomMetadata.style.bottom = '60px';
                        zoomMetadata.style.left = '20px';
                        zoomMetadata.style.right = '20px';
                        zoomMetadata.style.top = 'auto';
                        zoomMetadata.style.transform = 'none';
                    }
                    zoomMetadata.style.display = 'block';
                };

                zoomFrame.appendChild(video);
                currentMediaElement = video;
            } else {
                // Image
                const img = document.createElement('img');
                img.src = filePath;
                img.style.maxWidth = '90%';
                img.style.maxHeight = '90%';
                img.style.objectFit = 'contain';
                img.style.display = 'block';

                img.onerror = (e) => {
                    console.error('Image load error:', filePath, e);
                    zoomFrame.innerHTML = `<div style="color: #ff0000; padding: 20px; font-family: monospace; border: 2px solid #ff0000; text-align: center;">
                        <div style="font-weight: bold; margin-bottom: 10px;">‚ö† IMAGE LOAD ERROR</div>
                        <div style="font-size: 12px; margin-bottom: 5px;">File: ${fileName}</div>
                        <div style="font-size: 12px;">Path: ${filePath}</div>
                        <div style="font-size: 11px; margin-top: 10px; opacity: 0.7;">Check browser console for details</div>
                    </div>`;
                    zoomMetadata.style.display = 'none';
                };

                img.onload = () => {
                    console.log('Image loaded:', fileName, 'Size:', img.naturalWidth, 'x', img.naturalHeight);
                    const aspectRatio = img.naturalWidth / img.naturalHeight;
                    const isVertical = aspectRatio < 1;

                    // Position metadata based on aspect ratio
                    if (isVertical) {
                        zoomMetadata.style.right = '20px';
                        zoomMetadata.style.top = '50%';
                        zoomMetadata.style.transform = 'translateY(-50%)';
                        zoomMetadata.style.bottom = 'auto';
                        zoomMetadata.style.left = 'auto';
                    } else {
                        zoomMetadata.style.bottom = '60px';
                        zoomMetadata.style.left = '20px';
                        zoomMetadata.style.right = '20px';
                        zoomMetadata.style.top = 'auto';
                        zoomMetadata.style.transform = 'none';
                    }
                    zoomMetadata.style.display = 'block';
                };

                zoomFrame.appendChild(img);
                currentMediaElement = img;
            }
        }

        function closeZoom() {
            console.log('Closing theater mode');

            // Stop and cleanup current media
            if (currentMediaElement) {
                if (currentMediaElement.pause) {
                    currentMediaElement.pause();
                }
                currentMediaElement = null;
            }

            // Hide metadata
            const zoomMetadata = document.getElementById('zoom-metadata');
            if (zoomMetadata) zoomMetadata.style.display = 'none';

            // Clear frame
            const zoomFrame = document.getElementById('zoom-frame');
            if (zoomFrame) zoomFrame.innerHTML = '';

            // Hide modal
            document.getElementById('zoom-modal').classList.remove('active');

            // Reset state for next opening
            currentGallery = [];
            currentMediaIndex = 0;
            currentConfig = null;
        }

        function cycleGallery(direction) {
            if (currentGallery.length <= 1) return;
            if (direction === 'next') currentMediaIndex = (currentMediaIndex + 1) % currentGallery.length;
            else currentMediaIndex = (currentMediaIndex - 1 + currentGallery.length) % currentGallery.length;
            updateZoomDisplay();
        }

        // --- GLOBAL INTERACTIONS ---
        function triggerAction() {
            // Slide 5: Chart comparison cycling
            if (currentSlideIndex === 5) {
                currentVictimIndex = (currentVictimIndex + 1) % victimKeys.length;
                updateVictimChart(victimKeys[currentVictimIndex]);
                return;
            }

            // Slide 9: Verdict
            if (currentSlideIndex === 9) {
                const btn = document.getElementById('defeat-btn');
                btn.classList.add('active-press');
                setTimeout(() => btn.classList.remove('active-press'), 150);
                triggerVerdict();
                return;
            }

            const items = document.querySelectorAll(`#slide-${currentSlideIndex} .interactive-item`);
            if (items.length > 0) {
                if (interactionIndex >= items.length) interactionIndex = 0;
                items[interactionIndex].classList.add('action-pressed');
                setTimeout(() => items[interactionIndex].classList.remove('action-pressed'), 150);
                items[interactionIndex].click();
            }
        }

        function updateInteractionFocus() {
            document.querySelectorAll('.active-focus').forEach(el => el.classList.remove('active-focus'));
            const items = document.querySelectorAll(`#slide-${currentSlideIndex} .interactive-item`);
            if (items.length > 0) {
                if (interactionIndex >= items.length) interactionIndex = 0;
                items[interactionIndex].classList.add('active-focus');
            }
        }

        function triggerConfetti() {
            var end = Date.now() + 3000;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#000', '#facc15'], zIndex: 9999 });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#000', '#facc15'], zIndex: 9999 });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        function toggleSystem() {
            const root = document.getElementById('system-root');
            const blackout = document.getElementById('blackout-layer');

            if (!systemOn) {
                // TURN ON
                blackout.classList.add('hidden-layer');
                root.classList.remove('crt-off');
                root.classList.add('crt-on');
                systemOn = true;
            } else {
                // TURN OFF ‚Üí CRT animation ‚Üí page refresh
                blackout.classList.remove('hidden-layer');
                root.classList.remove('crt-on');
                void root.offsetWidth;
                root.classList.add('crt-off');
                systemOn = false;

                // After animation completes (600ms), reload page
                setTimeout(() => {
                    location.reload();
                }, 600);
            }
        }

        document.addEventListener('keydown', (e) => {
            // BLACKOUT LOGIC
            if (e.key === 'b' || e.key === 'B') {
                toggleSystem();
                return;
            }

            // Block everything else if System is OFF
            if (!systemOn) return;

            const isZoom = document.getElementById('zoom-modal').classList.contains('active');
            
            if (e.key === 'Alt') {
                e.preventDefault();
                if (currentSlideIndex === 8) {
                    const banner = document.getElementById('winner-ui');
                    banner.style.display = (banner.style.display === 'flex') ? 'none' : 'flex';
                }
                return;
            }

            switch(e.key) {
                case 'PageDown': case 'ArrowDown': case 'Right':
                    e.preventDefault(); 
                    if(isZoom) cycleGallery('next'); 
                    else goToSlide(currentSlideIndex + 1); 
                    break;
                case 'PageUp': case 'ArrowUp': case 'Left':
                    e.preventDefault(); 
                    if(isZoom) cycleGallery('prev'); 
                    else goToSlide(currentSlideIndex - 1); 
                    break;
                case 'Tab': 
                    e.preventDefault(); 
                    if (isZoom) closeZoom(); else triggerAction(); 
                    break;
            }
        });
    </script>
</body>
</html>
